<html ap:decorate="~{layout/layout-sub}">

<body>
<!-- #ap_container -->
<div ap:fragment="layout-contents">

	<div class="ap_contents">
		<div class="ap_com_cont cart">
			<!--/* [S] 장바구니 */-->
			<div class="payform_box">
				<!--/* page title */-->
				<th:block ap:replace="~{common/fragment/page-title}"/>
				<form id="order-info" class="validate" method="post" action="/order/reception">
					<!--/* cont_area */-->
					<div class="cont_area">
						<ul class="ui_step">
							<li class="current">1</li>
							<li>2</li>
							<li>3</li>
						</ul>

						<!--주문접수 데이터-->
						<input type="hidden" name="memberSn" th:value="${memberSn}"/>
						<input type="hidden" name="cartSn" th:value="${cartEx.cartSn}"/>
						<input type="hidden" name="orderFlag" value="cart"/>
						<input type="hidden" name="onlineProdSnArr"/>													<!--온라인쇼핑 상품-->
						<th:block th:unless="${memberSn > 0}"><input type="hidden" name="NonMember" value="NonMember"/></th:block>

						<prodlist></prodlist>
						<!-- 함께 보면 좋은 상품 -->
						<div class="tgArea cart_list">
							<dl>
								<dt class="on">
									<strong class="tit">함께 보면 좋은 상품</strong>
								</dt>
								<dd>
									<div class="cart_cont_slide">
										<div class="slide" data-ix-options="view-length:4; move-length:4;loop:false;datum-point:60">
											<div class="ix-list-viewport list_product wide155 ">
												<ul class="ix-list-items">
													<li class="ix-list-item">
														<div class="product_box">
															<a href="#none">
																<div class="visual_section">
																	<img ap:src="@{/images/dummy/img_cart_01.jpg}" alt="플라워 에센스 마스크">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<div class="benefit">
																		<span class="special">스페셜기프트</span>
																		<span class="gift">기프트카드</span>
																	</div>
																	<div class="soldout">
																		<span>일시품절</span>
																	</div>
																</div>
																<div class="info_section">
																	<p class="txt_name">프리메라</p>
																	<p class="txt_summary ellipsis line2">[NEW] ygq베이비 선쿠션리미티드 SPF32 PA++ 베이비 ygq선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++</p>
																	<div class="price_atc">
																		<!-- <span class="txt_sale">30%</span> -->
																		<span class="txt_price"><em>218,500</em>원</span>
																		<del class="txt_del">230,000원</del>
																	</div>
																	<div class="user_atc">
																		<span class="mark_star_sm star0"><span class="sr_only">구매 평점 별 5개 중 0개</span></span><!-- star0 ~ star5 -->
																		<span class="txt_review">리뷰 54,000</span>
																	</div>
																</div>
															</a>
															<div class="work_box">
																<ul class="item_user">
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_favorite"></i><!-- active : on -->
																			<span class="sr_only">좋아요</span>
																		</a>
																	</li>
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_basket"></i>
																			<span class="sr_only">장바구니</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
													</li>
													<li class="ix-list-item">
														<div class="product_box">
															<a href="#none">
																<div class="visual_section">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<div class="benefit">
																		<span class="special">스페셜기프트</span>
																		<span class="gift">기프트카드</span>
																	</div>
																	<div class="soldout">
																		<span>일시품절</span>
																	</div>
																</div>
																<div class="info_section">
																	<p class="txt_name">프리메라</p>
																	<p class="txt_summary ellipsis line2">[NEW] 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++</p>
																	<div class="price_atc">
																		<!-- <span class="txt_sale">1+1</span> -->
																		<span class="txt_price"><em>100,000</em>원</span>
																		<del class="txt_del">10,000원</del>
																	</div>
																	<div class="user_atc">
																		<span class="mark_star_sm star3"><span class="sr_only">구매 평점 별 5개 중 3개</span></span><!-- star0 ~ star5 -->
																		<span class="txt_review">리뷰 2,454</span>
																	</div>
																</div>
															</a>
															<div class="work_box">
																<ul class="item_user">
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_favorite"></i><!-- active : on -->
																			<span class="sr_only">좋아요</span>
																		</a>
																	</li>
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_basket"></i>
																			<span class="sr_only">장바구니</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
													</li>
													<li class="ix-list-item">
														<div class="product_box">
															<a href="#none">
																<div class="visual_section">
																	<img ap:src="@{/images/dummy/img_cart_01.jpg}" alt="플라워 에센스 마스크">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<div class="benefit">
																		<span class="special">스페셜기프트</span>
																		<span class="gift">기프트카드</span>
																	</div>
																	<div class="soldout">
																		<span>일시품절</span>
																	</div>
																</div>
																<div class="info_section">
																	<p class="txt_name">프리메라</p>
																	<p class="txt_summary ellipsis line2">[NEW] 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++</p>
																	<div class="price_atc">
																		<!-- <span class="txt_sale">30%</span> -->
																		<span class="txt_price"><em>218,500</em>원</span>
																		<del class="txt_del">230,000원</del>
																	</div>
																	<div class="user_atc">
																		<span class="mark_star_sm star0"><span class="sr_only">구매 평점 별 5개 중 0개</span></span><!-- star0 ~ star5 -->
																		<span class="txt_review">리뷰 54,000</span>
																	</div>
																</div>
															</a>
															<div class="work_box">
																<ul class="item_user">
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_favorite"></i><!-- active : on -->
																			<span class="sr_only">좋아요</span>
																		</a>
																	</li>
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_basket"></i>
																			<span class="sr_only">장바구니</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
													</li>
													<li class="ix-list-item">
														<div class="product_box">
															<a href="#none">
																<div class="visual_section">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<div class="benefit">
																		<span class="special">스페셜기프트</span>
																		<span class="gift">기프트카드</span>
																	</div>
																	<div class="soldout">
																		<span>일시품절</span>
																	</div>
																</div>
																<div class="info_section">
																	<p class="txt_name">프리메라</p>
																	<p class="txt_summary ellipsis line2">[NEW] 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++</p>
																	<div class="price_atc">
																		<!-- <span class="txt_sale">1+1</span> -->
																		<span class="txt_price"><em>100,000</em>원</span>
																		<del class="txt_del">10,000원</del>
																	</div>
																	<div class="user_atc">
																		<span class="mark_star_sm star3"><span class="sr_only">구매 평점 별 5개 중 3개</span></span><!-- star0 ~ star5 -->
																		<span class="txt_review">리뷰 2,454</span>
																	</div>
																</div>
															</a>
															<div class="work_box">
																<ul class="item_user">
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_favorite"></i><!-- active : on -->
																			<span class="sr_only">좋아요</span>
																		</a>
																	</li>
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_basket"></i>
																			<span class="sr_only">장바구니</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
													</li>
													<li class="ix-list-item">
														<div class="product_box">
															<a href="#none">
																<div class="visual_section">
																	<img ap:src="@{/images/dummy/img_cart_01.jpg}" alt="플라워 에센스 마스크">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<div class="benefit">
																		<span class="special">스페셜기프트</span>
																		<span class="gift">기프트카드</span>
																	</div>
																	<div class="soldout">
																		<span>일시품절</span>
																	</div>
																</div>
																<div class="info_section">
																	<p class="txt_name">프리메라</p>
																	<p class="txt_summary ellipsis line2">[NEW] ygq베이비 선쿠션리미티드 SPF32 PA++ 베이비 ygq선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++</p>
																	<div class="price_atc">
																		<!-- <span class="txt_sale">30%</span> -->
																		<span class="txt_price"><em>218,500</em>원</span>
																		<del class="txt_del">230,000원</del>
																	</div>
																	<div class="user_atc">
																		<span class="mark_star_sm star0"><span class="sr_only">구매 평점 별 5개 중 0개</span></span><!-- star0 ~ star5 -->
																		<span class="txt_review">리뷰 54,000</span>
																	</div>
																</div>
															</a>
															<div class="work_box">
																<ul class="item_user">
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_favorite"></i><!-- active : on -->
																			<span class="sr_only">좋아요</span>
																		</a>
																	</li>
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_basket"></i>
																			<span class="sr_only">장바구니</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
													</li>
													<li class="ix-list-item">
														<div class="product_box">
															<a href="#none">
																<div class="visual_section">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<div class="benefit">
																		<span class="special">스페셜기프트</span>
																		<span class="gift">기프트카드</span>
																	</div>
																	<div class="soldout">
																		<span>일시품절</span>
																	</div>
																</div>
																<div class="info_section">
																	<p class="txt_name">프리메라</p>
																	<p class="txt_summary ellipsis line2">[NEW] 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++</p>
																	<div class="price_atc">
																		<!-- <span class="txt_sale">1+1</span> -->
																		<span class="txt_price"><em>100,000</em>원</span>
																		<del class="txt_del">10,000원</del>
																	</div>
																	<div class="user_atc">
																		<span class="mark_star_sm star3"><span class="sr_only">구매 평점 별 5개 중 3개</span></span><!-- star0 ~ star5 -->
																		<span class="txt_review">리뷰 2,454</span>
																	</div>
																</div>
															</a>
															<div class="work_box">
																<ul class="item_user">
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_favorite"></i><!-- active : on -->
																			<span class="sr_only">좋아요</span>
																		</a>
																	</li>
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_basket"></i>
																			<span class="sr_only">장바구니</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
													</li>
													<li class="ix-list-item">
														<div class="product_box">
															<a href="#none">
																<div class="visual_section">
																	<img ap:src="@{/images/dummy/img_cart_01.jpg}" alt="플라워 에센스 마스크">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<div class="benefit">
																		<span class="special">스페셜기프트</span>
																		<span class="gift">기프트카드</span>
																	</div>
																	<div class="soldout">
																		<span>일시품절</span>
																	</div>
																</div>
																<div class="info_section">
																	<p class="txt_name">프리메라</p>
																	<p class="txt_summary ellipsis line2">[NEW] 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++</p>
																	<div class="price_atc">
																		<!-- <span class="txt_sale">30%</span> -->
																		<span class="txt_price"><em>218,500</em>원</span>
																		<del class="txt_del">230,000원</del>
																	</div>
																	<div class="user_atc">
																		<span class="mark_star_sm star0"><span class="sr_only">구매 평점 별 5개 중 0개</span></span><!-- star0 ~ star5 -->
																		<span class="txt_review">리뷰 54,000</span>
																	</div>
																</div>
															</a>
															<div class="work_box">
																<ul class="item_user">
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_favorite"></i><!-- active : on -->
																			<span class="sr_only">좋아요</span>
																		</a>
																	</li>
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_basket"></i>
																			<span class="sr_only">장바구니</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
													</li>
													<li class="ix-list-item">
														<div class="product_box">
															<a href="#none">
																<div class="visual_section">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<img ap:src="@{/images/dummy/img_cart_02.jpg}" alt="플라워 에센스 마스크">
																	<div class="benefit">
																		<span class="special">스페셜기프트</span>
																		<span class="gift">기프트카드</span>
																	</div>
																	<div class="soldout">
																		<span>일시품절</span>
																	</div>
																</div>
																<div class="info_section">
																	<p class="txt_name">프리메라</p>
																	<p class="txt_summary ellipsis line2">[NEW] 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++ 베이비 선쿠션리미티드 SPF32 PA++</p>
																	<div class="price_atc">
																		<!-- <span class="txt_sale">1+1</span> -->
																		<span class="txt_price"><em>100,000</em>원</span>
																		<del class="txt_del">10,000원</del>
																	</div>
																	<div class="user_atc">
																		<span class="mark_star_sm star3"><span class="sr_only">구매 평점 별 5개 중 3개</span></span><!-- star0 ~ star5 -->
																		<span class="txt_review">리뷰 2,454</span>
																	</div>
																</div>
															</a>
															<div class="work_box">
																<ul class="item_user">
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_favorite"></i><!-- active : on -->
																			<span class="sr_only">좋아요</span>
																		</a>
																	</li>
																	<li>
																		<a href="#none" role="button">
																			<i class="ico_basket"></i>
																			<span class="sr_only">장바구니</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
													</li>
												</ul>
											</div>
											<div class="ix-controller">
												<div class="slide_direction">
													<!-- "ix-btn-prev", "ix-btn-next" 는 "ix-controller" 안에 존재해야 한다.-->
													<a class="ix-btn-prev" href="#none"><span class="sr_only">Prev</span></a>
													<a class="ix-btn-next" href="#none"><span class="sr_only">Next</span></a>
												</div>
											</div>
										</div>
									</div>
								</dd>
							</dl>
						</div>
						<!-- // 함께 보면 좋은 상품 -->
					</div>
					<calcresult></calcresult>
				</form>
			</div>
		</div>
	</div>
</div><!-- // #ap_container -->

<th:block ap:fragment="layout-endpoint">

	<script ap:src="@{/handlebars-templates/compiled/cart/online/prod.js}"></script>						<!-- 온라인 상품 -->
	<script ap:src="@{/handlebars-templates/compiled/cart/online/membership-point-prod.js}"></script>		<!-- 온라인 뷰티포인트상품 -->
	<script ap:src="@{/handlebars-templates/compiled/cart/online/mn-promo-list.js}"></script>				<!-- 온라인 프로모션 상품목록 -->

	<script ap:src="@{/handlebars-templates/compiled/cart/calculation-result.js}"></script>					<!-- 결제목록 -->

	<script ap:src="@{/handlebars-templates/compiled/cart/empty-prod.js}"></script>							<!-- 상품목록이 존재하지 않을때 -->

	<script ap:src="@{/handlebars-templates/compiled/cart/layer-option-01.js}"></script>						<!--옵션변경 -->
	<script ap:src="@{/handlebars-templates/compiled/cart/none-member-order-info-modal.js}"></script>		<!-- 로그인유도 모달 -->

	<script th:inline="javascript">

	$( document ).ready(function() {
		$( '.ui_spinner' ).spinner()

		/* 주문서 진입 실패시 에러처리 */
		var ordErr = /*[[${ordErr}]]*/ null;
		if(ordErr != null){
			var result = ordErr.result,
				errorCode = ordErr.errorCode,
				errorMessage = ordErr.errorMessage,
				errorAdditional = ordErr.errorAdditional;
			if (!result) {
				AP.modal.alert(errorMessage + '(' + errorCode + ')<br/>' + errorAdditional.detail);
			}
		}
	});

	/* 테이크아웃 기본정보 */
	var ret = false;
	var pageLimit = 5;
	var currentKeyword;

	/* 회원일련 번호*/
	var memberSn = /*[[${memberSn}]]*/;

	/* 카트 정보 */
	var cartEx = /*[[${cartEx}]]*/;

	/* 뷰티포인트 정보 */
	var bpMembershipEx = /*[[${bpCartMemberMembershipEx}]]*/;

	/* 랭킹 상품 목록 */
	var bestProdList = /*[[${bestProdList}]]*/;

	/* 장바구니 번호 */
	var cartSn = cartEx.cartSn;

	var xhr;

	// 전체장바구니상품
	var allCartProd = [];

	/* 온라인 상품 */
	setOnlineProd();

	/* 프로모션 포인트 상품 합 표시 */
	setPromPrice();

	/* 상품가격 정보 */
	setCalculationResult();

	/* ui 스크립트 초기화*/
	uiScriptInit();

	/* 온라인상품 */
	function setOnlineProd() {
		$( '.ui_spinner' ).spinner();
		$('prodlist').empty();
		setAllCartListProd();
		setProdAwardViewData()

		console.log(cartEx);
		//자사
		if (cartEx.cartDeliveryOnlineProdExList.length > 0 ||
			cartEx.cartDeliveryMembershipPointExchOnlineProdExList.length > 0 ||
			cartEx.cartDeliveryMNPromoExList.length > 0) {

			var prodCnt = getCalculationProdCntFromOnlineProd(cartEx.ownerCartCoEx.coSn);

			var onlineHtml = AP.common.getTemplate('cart.online.prod', {
				cartEx : cartEx,
				cartSn : cartEx.cartSn,
				cartCoEx : cartEx.ownerCartCoEx,
				prodCnt : prodCnt,
				first : true
			});
			$('prodlist').append(onlineHtml);
		}
		//입점몰
		if (cartEx.cartOtfInfoList.length > 0) {
			for(var i in cartEx.cartOtfInfoList){
				if (cartEx.cartOtfInfoList[i].cartDeliveryOnlineProdExList.length > 0 ||
					cartEx.cartOtfInfoList[i].cartDeliveryMembershipPointExchOnlineProdExList.length > 0 ||
					cartEx.cartOtfInfoList[i].cartDeliveryMNPromoExList.length > 0) {

					var prodCnt = getCalculationProdCntFromOnlineProd(cartEx.cartOtfInfoList[i].cartCoEx.coSn);

					var onlineHtml = AP.common.getTemplate('cart.online.prod', {
						cartEx: cartEx.cartOtfInfoList[i],
						cartSn: cartEx.cartSn,
						cartCoEx: cartEx.cartOtfInfoList[i].cartCoEx,
						prodCnt : prodCnt
					});
					$('prodlist').append(onlineHtml);
				}
			}
		}
		if (cartEx.cartDeliveryOnlineProdExList.length == 0
			&& cartEx.cartDeliveryMNPromoExList.length == 0
			&& cartEx.cartDeliveryMembershipPointExchOnlineProdExList.length == 0) {
			var onlineHtml = AP.common.getTemplate('cart.empty-prod', {
				bestProdList: bestProdList
			});
			$('prodlist').empty();
			$('prodlist').append(onlineHtml);
		}
		$('[name=chkBox]').on('click', function(e) {
			/* 재고수량 체크 */
			if(fnCheckPossibleQty($(this)) == false){
				return;
			}
			if($(this).is(":checked")){
				if(fncheckExchPoint($(this)) == false){
					return;
				}
			}
			calculateSelectCartProds();
		});
		$('input[name=cartCoAllProdCheck]').on('click',function(e){
			var coSn = $(this).attr('coSn');
			if($(this).is(":checked")){
				$("dd[coSn='" + coSn + "']").find('input[name=chkBox]:enabled').each(function(){
					$(this).prop('checked', true);
				})
			} else {
				$("dd[coSn='" + coSn + "']").find('input[name=chkBox]:enabled').each(function(){
					$(this).prop('checked', false);
				})
			}
			calculateSelectCartProds();
		})

		$('input[name=cartCoAllProdCheck]:enabled').each(function(){
			var coSn = $(this).attr('coSn');
			$(this).prop('checked', $("dd[coSn='" + coSn + "']").find('input[name=chkBox]:enabled').length == $("dd[coSn='" + coSn + "']").find('input[name=chkBox]:checked:enabled').length);
		});
	}

	/*전체 상품 목록 추가*/
	function setAllCartListProd(){
		allCartProd = [];
		if (cartEx.cartDeliveryOnlineProdExList.length > 0 ||
			cartEx.cartDeliveryMembershipPointExchOnlineProdExList.length > 0 ||
			cartEx.cartDeliveryMNPromoExList.length > 0) {

			setCartListProd(cartEx.cartDeliveryOnlineProdExList, cartEx.ownerCartCoEx.coSn);
			setCartListProd(cartEx.cartDeliveryMembershipPointExchOnlineProdExList, cartEx.ownerCartCoEx.coSn, 'Y');
			for (var i in cartEx.cartDeliveryMNPromoExList) {
				setCartListProd(cartEx.cartDeliveryMNPromoExList[i].promoOnlineProdExList, cartEx.ownerCartCoEx.coSn);
			}
		}
		if (cartEx.cartOtfInfoList.length > 0) {
			for(var i in cartEx.cartOtfInfoList){
				if (cartEx.cartOtfInfoList[i].cartDeliveryOnlineProdExList.length > 0 ||
					cartEx.cartOtfInfoList[i].cartDeliveryMembershipPointExchOnlineProdExList.length > 0 ||
					cartEx.cartOtfInfoList[i].cartDeliveryMNPromoExList.length > 0) {

					setCartListProd(cartEx.cartOtfInfoList[i].cartDeliveryOnlineProdExList, cartEx.cartOtfInfoList[i].cartCoEx.coSn);
					setCartListProd(cartEx.cartOtfInfoList[i].cartDeliveryMembershipPointExchOnlineProdExList, cartEx.cartOtfInfoList[i].cartCoEx.coSn, 'Y');
					for (var j in cartEx.cartOtfInfoList[i].cartDeliveryMNPromoExList) {
						setCartListProd(cartEx.cartOtfInfoList[i].cartDeliveryMNPromoExList[j].promoOnlineProdExList, cartEx.cartOtfInfoList[i].cartCoEx.coSn);
					}
				}
			}
		}
	}

	/* 전체상품 배열에 목록 추가 */
	function setCartListProd(list, coSn, membershipProdYn) {
		for(var i in list){
			list[i].coSn = coSn;
			list[i].membershipProdYn = membershipProdYn;
			allCartProd.push(list[i]);
		}
	}

	/*온라인 상품별 단위상품 갯수 계산*/
	function getCalculationProdCntFromOnlineProd(coSn){
		var prodCnt = 0;
		for(var i in allCartProd){
			if(allCartProd[i].selectYn == 'Y'){
				if(coSn == allCartProd[i].coSn){
					for(var j in allCartProd[i].cartProdExList){
						if(allCartProd[i].cartProdExList[j].prodEx.saleDisplayStatus == 'OnSale'){
							prodCnt++;
						}
					}
				}
			}
		}
		return prodCnt;
	}


	/*온라인 상품별 사은품 정리 추가*/
	function setProdAwardViewData(){
		cartEx.cartDeliveryOnlineProdExList = roofSetAwardViewData(cartEx.cartDeliveryOnlineProdExList);
		cartEx.cartDeliveryMembershipPointExchOnlineProdExList = roofSetAwardViewData(cartEx.cartDeliveryMembershipPointExchOnlineProdExList);
		for(var i in cartEx.cartDeliveryMNPromoExList){
			cartEx.cartDeliveryMNPromoExList[i].promoOnlineProdExList = roofSetAwardViewData(cartEx.cartDeliveryMNPromoExList[i].promoOnlineProdExList);
		}
		for(var i in cartEx.cartOtfInfoList){
			cartEx.cartOtfInfoList[i].cartDeliveryOnlineProdExList = roofSetAwardViewData(cartEx.cartOtfInfoList[i].cartDeliveryOnlineProdExList);
			cartEx.cartOtfInfoList[i].cartDeliveryMembershipPointExchOnlineProdExList = roofSetAwardViewData(cartEx.cartOtfInfoList[i].cartDeliveryMembershipPointExchOnlineProdExList);
			for(var j in cartEx.cartOtfInfoList[i].cartDeliveryMNPromoExList){
				cartEx.cartOtfInfoList[i].cartDeliveryMNPromoExList[j].promoOnlineProdExList = roofSetAwardViewData(cartEx.cartOtfInfoList[i].cartDeliveryMNPromoExList[j].promoOnlineProdExList);
			}
		}
	}
	/*온라인 상품별 사은품 정리 루프*/
	function roofSetAwardViewData(list){
		for(var i in list){
			list[i].cartOnlineProdAward = {};
			for(var j in list[i].cartProdExList){
				if(list[i].cartProdExList[j].cartProdAwardList && list[i].cartProdExList[j].cartProdAwardList.length !== 0){	//상품사은품+기프트카드 존재할 경유
					//온라인 묶음으로 사은품 정리할 공간
					for(var k in list[i].cartProdExList[j].cartProdAwardList){
						if(list[i].cartProdExList[j].cartProdAwardList[k].awardTgtCode ==='Prod'){
							var awardProdSn = list[i].cartProdExList[j].cartProdAwardList[k].awardProdEx.prodSn;	//사은품 일련번호
							if(!(list[i].cartOnlineProdAward.prod)){
								list[i].cartOnlineProdAward.prod = {};
							}
							if(list[i].cartOnlineProdAward.prod[awardProdSn] === undefined || list[i].cartOnlineProdAward.prod[awardProdSn] === null){
								list[i].cartOnlineProdAward.prod[awardProdSn] = list[i].cartProdExList[j].cartProdAwardList[k];
							}else{
								list[i].cartOnlineProdAward.prod[awardProdSn].awardQty += list[i].cartProdExList[j].cartProdAwardList[k].awardQty
							}
						}else if(list[i].cartProdExList[j].cartProdAwardList[k].awardTgtCode ==='Giftcard'){
							if(!(list[i].cartOnlineProdAward.giftCardAmount)){
								list[i].cartOnlineProdAward.giftCardAmount = 0;
							}
							list[i].cartOnlineProdAward.giftCardAmount += list[i].cartProdExList[j].cartProdAwardList[k].awardGiftcardEx.giftcardBaseAmt;
						}
					}
				}
			}
		}
		return list;
	}

	/* 최종결제 금액 계산 */
	function setCalculationResult() {

		$('calcresult').empty();

		var membershipSn;

		var totalProdCnt = 0;
		var shipFeeSumAmount = 0;
		var prodSumAmount = 0;
		var totalMemAmount = 0;

		if (cartEx.cartDeliveryOnlineProdExList.length != 0
			|| cartEx.cartDeliveryMNPromoExList.length != 0
			|| cartEx.cartDeliveryMembershipPointExchOnlineProdExList.length != 0) {

			for (var i in cartEx.calculationResult.resultOtfList) {
				cartEx.calculationResult.resultOtfList[i].otfProdTotalCnt = 0;		//업체별 수량

				if (cartEx.calculationResult.resultOtfList[i].requestOtf != undefined) {
					for (var j in allCartProd) {
						if (cartEx.calculationResult.resultOtfList[i].requestOtf.coSn == allCartProd[j].coSn) {
							for (var k in allCartProd[j].cartProdExList) {
								if (allCartProd[j].cartProdExList[k].selectYn === 'Y') {
									if (allCartProd[j].cartProdExList[k].prodEx.saleDisplayStatus == 'OnSale') {
										if (allCartProd[j].cartProdExList[k].exchYn === 'Y') {
											totalMemAmount += allCartProd[j].cartProdExList[k].exchPoint;
										}
										totalProdCnt++;
										cartEx.calculationResult.resultOtfList[i].otfProdTotalCnt++;
									}
								}
							}
						}
					}
					prodSumAmount += cartEx.calculationResult.resultOtfList[i].onlineSalesTotalAmountInfo.standardCurrency.amount;
					shipFeeSumAmount += cartEx.calculationResult.resultOtfList[i].defaultShipFeeInfo.standardCurrency.amount;
				}
			}
		}

		if(cartEx.cartMemberEx){
			for(var i in cartEx.cartMemberEx.memberMembershipExList){
				if(cartEx.cartMemberEx.memberMembershipExList[i].membershipServiceCode == "BP"){
					membershipSn = cartEx.cartMemberEx.memberMembershipExList[i].membershipSn + "";
				}
			}
		}

		var calculationHtml = AP.common.getTemplate('cart.calculation-result', {
			cartEx: cartEx,
			shipFeeSumAmount: shipFeeSumAmount,
			totalMemAmount: totalMemAmount,
			prodSumAmount: prodSumAmount,
			totalProdCnt: totalProdCnt,
			membershipSn: membershipSn
		});
		$('calcresult').append(calculationHtml);
	}

	/* ui 스크립트 초기화*/
	function uiScriptInit(){

		$('.ui_accordion').accordion('clear');
		$('.ui_accordion').accordion();
		$( '.ui_select' ).designSelectBox();
		$( '.ui_spinner' ).spinner();
		$( '.slide' ).ixSlideMax();
		//토글 슬라이드
		$('.tgArea').each(function(){
			$(this).find('dl > dt').on('click', function(){
				$(this).toggleClass('on');
				$( '.slide' ).ixSlideMax();
			})
		});

		$('.tumb_slide li:eq(6)').addClass("act");
		function rolling_thumb(){
			var $thumb_li = $('.tumb_slide li');
			var $thumb_li_first = $('.tumb_slide li:first-child');
			var $thumb_li_last = $('.tumb_slide li:last-child');

			var $thumb_li_6 = $('.tumb_slide li:eq(6)');
			var $thumb_li_7 = $('.tumb_slide li:eq(7)');

			$thumb_li_first.before($thumb_li_7.clone());
			$thumb_li_last.after($thumb_li_6.clone());

			$thumb_li_7.remove();
			$thumb_li_6.remove();
			var $thumb_li_last_re = $('.tumb_slide li:last-child');
			var $thumb_li_act = $('.tumb_slide li:eq(6)');
			$thumb_li_last_re.hide().slideDown();
			$thumb_li.removeClass("act");
			$thumb_li_act.addClass("act");
		}
		setInterval(function(){
			rolling_thumb();
		},5000);
	}

	/* 프로모션, 뷰티포인트 상품 토탈 금액 찍는 함수*/
	function setPromPrice() {
		var promPointAmountJson = {
			allAmountPromoSn: {sign: '원'},
			allAmountMemCartSn: {sign: 'P'}
		};
		$("strong[name='promoAmount']").each(function () {
			if($(this).attr('saleDisplayStatus') === 'OnSale') {
				if ($(this).attr('selectYn') === 'Y') {
					if (promPointAmountJson['allAmountPromoSn'][$(this).attr('promoSn')] == undefined || promPointAmountJson['allAmountPromoSn'][$(this).attr('promoSn')] == null) {
						promPointAmountJson['allAmountPromoSn'][$(this).attr('promoSn')] = amountRemoveString($(this).html());
					} else {
						promPointAmountJson['allAmountPromoSn'][$(this).attr('promoSn')] += amountRemoveString($(this).html());
					}
				}
			}
		})
		$("strong[name='memAmount']").each(function () {
			if($(this).attr('saleDisplayStatus') === 'OnSale'){
				if($(this).attr('selectYn') === 'Y') {
					if (promPointAmountJson['allAmountMemCartSn'][$(this).attr('memCartSn')] == undefined || promPointAmountJson['allAmountMemCartSn'][$(this).attr('memCartSn')] == null) {
						promPointAmountJson['allAmountMemCartSn'][$(this).attr('memCartSn')] = amountRemoveString($(this).html());
					} else {
						promPointAmountJson['allAmountMemCartSn'][$(this).attr('memCartSn')] += amountRemoveString($(this).html());
					}
				}
			}
		})
		for (var i in promPointAmountJson) {
			for (var j in promPointAmountJson[i]) {
				if (j != 'sign') {
					$("span[" + i + "='" + j + "']").html(amountAddString(promPointAmountJson[i][j], promPointAmountJson[i]['sign']));
				}
			}
		}
		cartEx.promPointAmountJson = promPointAmountJson;
	}


	/* 금액에서 문자부분 제거 */
	function amountRemoveString(value){
		return value.replace(',', '').replace('원', '').replace('P', '') * 1;
	}

	/* 금액 문자부분 추가 */
	function amountAddString(value, sign){
		if(sign){
			return (value + "").replace(/(^[+-]?\d+)(\d{3})/, '$1' + ',' + '$2') + sign;
		}else{
			return (value + "").replace(/(^[+-]?\d+)(\d{3})/, '$1' + ',' + '$2');
		}
	}

	/* 주문하기전 검사 */
	function fnCheckOrder() {

		var chkCnt 	= $("[name=chkBox]:checked:enabled").length;			// 온라인상품 선택갯수

		// 온라인 상품이 체크되지 않았을때
		if (chkCnt == 0) {
			AP.modal.alert("선택된 상품이 없습니다.");
			return false;
		}
		if(AP.LOGIN_USER){
			fnOrderProdReception(chkCnt, 0);
		}else{
			if(chkCnt > 0){
				var modal = AP.modal.open({
					templateKey : 'cart.none-member-order-info-modal'
				});
				modal.resetPosition(true);
				$("#cancel").on('click', function() {
					modal.close();
				});
				$("#nonSignInPurchase").on('click', function(){
					modal.close();
					fnOrderProdReception(chkCnt, 0);
				});
				$("#loginPurchase").on('click', function(){
					url = AP.path.CART;
					location.href = url + (( true ) ? '?isRequiredLogin=true' : '' );
				});
			}
		}
		return true;
	}

	/* 주문하기*/
	function fnOrderProdReception(chkCnt) {
		var prdCdArr = [];
		var prdInfoVal;
		var possibleQtyBool = true
		if(chkCnt > 0){
			$("input[name=chkBox]:checked:enabled").each(function() {
				possibleQtyBool = fnCheckPossibleQty($(this))
				if(possibleQtyBool) {//재고수량 검사
					var rowChkVal = $(this).val();
					$('.inner[data-value="' + rowChkVal + '"]').each(function () {
						$(this).find("[name='prdInfo']").each(function () {
							if ($(this).attr("saleDisplayStatus") == "OnSale") {
								prdInfoVal = $(this).val();
								prdCdArr.push(prdInfoVal);
								$("[name='onlineProdSnArr']").val(prdCdArr);
							}
						});
					})
				}else{
					return;
				}
			});
			if(possibleQtyBool){
				var $form = $('form.validate');
				$form.submit();
			}
		}
	}

	/* 선택삭제 */
	function selectRemoveCartProd() {

		var chkCnt 			= $("[name=chkBox]:checked:enabled").length;			// 온라인상품 선택갯수

		if (chkCnt == 0) {
			AP.modal.alert("선택된 상품이 없습니다.");
			return false;
		}
		AP.modal.confirm( '선택한 상품을 장바구니에서 삭제하시겠습니까? ' ).addListener( 'modal-close', function (e) {
			//console.log( e.closeType ); //close, confirm, cancel
			if(e.closeType == 'confirm'){
				var prdCdArr = [];
				var prdInfoVal;

				if(chkCnt > 0 ){
					$("input[name=chkBox]:checked:enabled").each(function() {
						var rowChkVal = $(this).val();
						$('.inner[data-value="' + rowChkVal + '"]').each(function(){
							$(this).find("[name='prdInfo']").each(function(){
								prdInfoVal = $(this).val();
								prdCdArr.push(prdInfoVal);
							});
						})
					});
				}
				jQuery.ajaxSettings.traditional = true;
				AP.api.removeSelectCartProd({}, {
					cartSn : cartSn,
					prdCdArr: prdCdArr,
				}).done(function (data) {
					if (data.data) {
						AP.modal.alert("해당상품이 삭제되었습니다.").addListener( 'modal-close', function (e) {
							cartEx = data.data;
							setOnlineProd();
							setCalculationResult();
							setPromPrice();
							uiScriptInit();
						});
					}
				}).fail(function (e) {
					AP.modal.alert("fail");
				}).always(function () {

				});
			}
		});
	}

	/* 선택상품재계산 */
	function calculateSelectCartProds() {

		var prdCdArr = [];
		var prdInfoVal;

		var chkCnt = $("[name=chkBox]:checked:enabled").length;					// 온라인상품 선택갯수

		if(chkCnt > 0 ){
			$("input[name=chkBox]:checked:enabled").each(function() {
				var rowChkVal = $(this).val();
				$('.inner[data-value="' + rowChkVal + '"]').each(function(){
					$(this).find("[name='prdInfo']").each(function(){
						prdInfoVal = $(this).val();
						prdCdArr.push(prdInfoVal);
					});
				})
			});
		}

		jQuery.ajaxSettings.traditional = true;
		AP.api.getCartBySelectCartProds({}, {
			cartSn : cartSn,
			prdCdArr: prdCdArr,
		}).done(function (data) {
			if (data.data) {
				cartEx = data.data;
				setOnlineProd();
				setCalculationResult();
				setPromPrice();
				uiScriptInit();
			}
		}).fail(function (e) {
			AP.modal.alert("fail");
		}).always(function () {
		});
	}

	/* 맴버쉽 포인트 체크 */
	function fncheckExchPoint(obj) {

		if(memberSn > 0){
			var membershipPoints = 0;
			var membershipSum = 0;

			$('[name=chkBox]:checked:enabled').each(function () {
				if ($(this).attr('pointExch') != undefined && $(this).attr('ppromoSnointExch') == "membership") {
					membershipSum += Number($(this).attr('point'));
				}
			});

			if(bpMembershipEx != null){
				membershipPoints = bpMembershipEx.membershipPoints;
			}else{
				membershipPoints = 0;
			}

			if (membershipSum > membershipPoints) {
				AP.modal.alert('보유 뷰티포인트가 부족합니다. 상품을 다시 선택해주세요.');
				$(obj).prop('checked', false);
				return false;
			}else{
				$(obj).prop('checked', true);
			}
			return true;
		}
	}

	/* 단일삭제(단위상품기준) */
	function removeCartProd(cartSn, cartProdSn) {
		AP.modal.confirm( '선택한 상품을 장바구니에서 삭제하시겠습니까? ' ).addListener( 'modal-close', function (e) {
			if(e.closeType == 'confirm'){
				jQuery.ajaxSettings.traditional = true;
				AP.api.removeCartProd({}, {
					cartSn: cartSn,
					cartProdSn : cartProdSn
				}).done(function (data) {
					if (data.data) {
						AP.modal.alert("해당상품이 삭제되었습니다.").addListener( 'modal-close', function (e) {
							cartEx = data.data;
							setOnlineProd();
							setCalculationResult();
							setPromPrice();
							uiScriptInit();
						});
					}
				}).fail(function (e) {
					AP.modal.alert("fail");
				}).always(function () {
					// 성공, 실패
				});
			}
		});
	}

	/* 단일삭제(온라인상품기준) */
	function removeCartOnlineProd(cartSn, onlineProdSn) {
		AP.modal.confirm( '선택한 상품을 장바구니에서 삭제하시겠습니까? ' ).addListener( 'modal-close', function (e) {
			if(e.closeType == 'confirm'){
				var prdCdArr = [];
				var prdInfoVal;

				$('.item_list').find("input[onlinePrdSn='" + onlineProdSn + "']").each(function () {
					prdInfoVal = $(this).val();
					prdCdArr.push(prdInfoVal);
				})

				jQuery.ajaxSettings.traditional = true;
				AP.api.removeSelectCartProd({}, {
					cartSn : cartSn,
					prdCdArr: prdCdArr,
				}).done(function (data) {
					if (data.data) {
						AP.modal.alert("해당상품이 삭제되었습니다.").addListener( 'modal-close', function (e) {
							cartEx = data.data;
							setOnlineProd();
							setCalculationResult();
							setPromPrice();
							uiScriptInit();
						});
					}
				}).fail(function (e) {
					AP.modal.alert("fail");
				}).always(function () {
					// 성공, 실패
				});
			}
		});
	}

	/* 주문수량 수정 */
	function prodQtyOperate(num, cartSn, cartProdSn, prodSn,
							integrationMembershipExchYn, operate) {

		var ordQty = parseInt($(num).closest("div").find("input[name=cartProdQty]").val());
		if(operate == '+'){
			ordQty++;
		}
		else if(operate == '-'){
			ordQty--;
		}
		if (xhr != null){
			xhr.abort();
		}
		var indexed_array = {};
		indexed_array['cartSn'] = cartSn;
		indexed_array['cartProdSn'] = cartProdSn;
		indexed_array['prodSn'] = prodSn;
		indexed_array['cartProdQty'] = ordQty;
		indexed_array['integrationMembershipExchYn'] = integrationMembershipExchYn;
		indexed_array['modifyType'] = "Q";

		var cartBulkIncludedProdSn	= $('.pack_prd').find("[name='bulkPrdInfo_" + cartProdSn + "']").attr('cartBulkIncludedProdSn');
		var bulkDcIncludedProdGrpSn	= $('.pack_prd').find("[name='bulkPrdInfo_" + cartProdSn + "']").attr('bulkDcIncludedProdGrpSn');
		var includedProdSn			= $('.pack_prd').find("[name='bulkPrdInfo_" + cartProdSn + "']").attr('includedProdSn');
		var includedProdQty			= $('.pack_prd').find("[name='bulkPrdInfo_" + cartProdSn + "']").attr('includedProdQty');

		if(cartBulkIncludedProdSn != undefined
			&& bulkDcIncludedProdGrpSn != undefined
			&& includedProdSn != undefined
			&& includedProdQty != undefined){
			indexed_array['cartBulkIncludedProdSn'] = cartBulkIncludedProdSn;
			indexed_array['bulkDcIncludedProdGrpSn'] = bulkDcIncludedProdGrpSn;
			indexed_array['includedProdSn'] = includedProdSn;
			indexed_array['includedProdQty'] = includedProdQty;
		}

		xhr = $.ajax({
			type: "PUT",
			url: "/cart/modifyCartProd",
			data: indexed_array,
			error : function(xhr, textStatus, errorThrown) {},
			success: function(data){
				if (data.data) {
					cartEx = data.data;
					setOnlineProd();
					setCalculationResult();
					setPromPrice();
					uiScriptInit();
				}
			}
		});
	}

	/* 재고수량 체크 */
	function fnCheckPossibleQty(obj) {

		var returnVal = true;
		obj.closest('li').find('[cartProdQty]').each(function(){
			// 온라인상품명
			var onlineProdName = $(this).attr('onlineProdName');
			// 주문수량
			var cartProdQty	= $(this).attr('cartProdQty');
			// 최소수량
			var minPurLimitQty	= $(this).find('[minPurLimitQty]').attr('minPurLimitQty');
			// 최대수량
			var maxPurLimitQty	= $(this).find('[maxPurLimitQty]').attr('maxPurLimitQty');

			// 최소구매수량 > 주문수량
			if( Number(minPurLimitQty) > Number(cartProdQty) ){
				AP.modal.alert(onlineProdName + ' 상품은 ' + minPurLimitQty + '개 이상 구매 가능합니다.<br> 주문수량을 변경해 주세요.');
				obj.prop('checked', false);
				returnVal = false;
				return false;
			}

			// 주문수량 > 최대구매수량
			if( Number(cartProdQty) > Number(maxPurLimitQty) ){
				AP.modal.alert(onlineProdName + ' 상품은 ' + maxPurLimitQty + '개 구매 가능합니다.<br> 주문수량을 변경해 주세요.');
				obj.prop('checked', false);
				returnVal = false;
				return false;
			}
		})


		obj.closest('li').find('.pack_prd input').each(function(){
			// 온라인상품명
			var prodName = $(this).attr('prodName');
			// 주문수량
			var totalBulkProdQty = $(this).attr('totalBulkProdQty');
			//최대수량 체크 YN
			var maxPurLimitYn = $(this).attr('maxPurLimitYn');
			// 최소수량
			var minPurLimitQty	= $(this).attr('minPurLimitQty');
			// 최대수량
			var maxPurLimitQty	= $(this).attr('maxPurLimitQty');

			// 최소구매수량 > 주문수량
			if( Number(minPurLimitQty) > Number(totalBulkProdQty) ){
				AP.modal.alert(prodName + ' 상품은 ' + minPurLimitQty + '개 이상 구매 가능합니다.<br> 주문수량을 변경해 주세요.');
				obj.prop('checked', false);
				returnVal = false;
				return false;
			}

			// 주문수량 > 최대구매수량
			if(maxPurLimitYn == 'Y'){
				if( Number(totalBulkProdQty) > Number(maxPurLimitQty) ){
					AP.modal.alert(prodName + ' 상품은 ' + maxPurLimitQty + '개 구매 가능합니다.<br> 주문수량을 변경해 주세요.');
					obj.prop('checked', false);
					returnVal = false;
					return false;
				}
			}
		})
		return returnVal;
	}


	/* 옵션변경 Layer */
	function fnUnitVariationProds(cartSn, cartProdSn, prodSn, cartProdQty, el) {
		if($(el).parent().parent().find('.item_change').hasClass('on')) {
			if ($(el).parent().parent().find('.item_change').hasClass('on')) {
				$(el).parent().parent().find('.item_change').removeClass('on').slideUp('fast');
				$(el).text('주문변경');
			}
		}else{
			AP.api.getLayerPage({}, {
				cartProdSn: cartProdSn,
				prodSn: prodSn
			}).done(function (data) {
				if (data.param.length > 0) {
					if (data.result == "success") {
						if (!($(el).parent().parent().find('.item_change').hasClass('on'))) {
							$(el).parent().parent().find('.item_change').addClass('on').slideDown('fast');
							$(el).text('옵션닫기');
						}
						$('.item_change[cartProdSn="' + cartProdSn + '"]').empty();

						var optionLayer = AP.common.getTemplate('cart.layer-option-01', {
							list: data.param,
							prodSn: prodSn,
							cartProdQty: cartProdQty,
						});
						$('.item_change[cartProdSn="' + cartProdSn + '"]').append(optionLayer);

						$('.ui_select').designSelectBox();

						//옵션 선택시
						$('.select_wrap .ui_select .select_options li').click(function () {
							var prodSnVal = $(this).find("a").attr("data-value")
							if(prodSnVal == ''){
								AP.modal.alert("변경하실 옵션을 선택하세요.");
							}else {
								var indexed_array = {};
								indexed_array['cartSn'] = cartSn;
								indexed_array['cartProdSn'] = cartProdSn;
								indexed_array['prodSn'] = prodSnVal
								indexed_array['cartProdQty'] = cartProdQty
								indexed_array['modifyType'] = "O";

								xhr = $.ajax({
									type: "PUT",
									url: "/cart/modifyCartProd",
									data: indexed_array,
									error : function(xhr, textStatus, errorThrown) {},
									success: function(data){
										if (data.data) {
											cartEx = data.data;
											setOnlineProd();
											setCalculationResult();
											setPromPrice()
											uiScriptInit();
										}
									}
								});
							}
						});
					}
				} else {
					AP.modal.alert("변경 가능한 옵션상품이 없습니다.");
				}
			}).fail(function (e) {
				AP.modal.alert("[ajax.fail]실패");
				modal.close();
			}).always(function () {
			});
		}
	}
	</script>
</th:block>
</body>
</html>