<html ap:decorate="~{layout/default}">

<body>
<!-- #ap_container -->
<div ap:fragment="layout-contents">
	<!-- page title -->
	<th:block ap:replace="~{common/fragment/contents-page-title}"/>
	<!-- // page title -->
	<div class="ap_contents">
		<div class="member_login">
			<!--/* 탭 메뉴 */-->
			<div class="ui_tab">
				<div class="tab_menu equally">
					<ul>
						<li class="on">
							<button type="button">회원</button>
						</li>
						<li>
							<button type="button">휴대폰 로그인</button>
						</li>
						<li>
							<button type="button">비회원(주문조회)</button>
						</li>
					</ul>
				</div>
				<form th:method="${method}" id="sub" th:action="${returnUrl}">
					<th:block th:if="${pVal}" th:each="item : ${pVal}">
						<th:block th:if="${pVal}" th:each="item : ${pVal}">
							<input  type="hidden" th:name="${item.key}" th:value="${item.value}">
						</th:block>
					</th:block>
				</form>
				<div class="tab_contents">
					<div class="tab_cont">
						<h3 class="sr_only">회원</h3>
						<form id="main">
							<fieldset class="form">
								<legend class="sr_only">로그인</legend>
								<div class="input_wrap">
									<input type="text" title="아이디 입력" name="chcsNo" placeholder="아이디" required="required" data-msg-required="아이디를 입력해 주세요. 아이디 입력란으로 이동합니다.">
									<button class="btn_del" type="button"><span class="sr_only">입력된 아이디 삭제</span></button>
								</div>
								<div class="input_wrap">
									<input type="password" title="비밀번호 입력" name="userPwdEc" placeholder="비밀번호" required="required" data-msg-required="비밀번호를 입력해 주세요. 비밀번호 입력란으로 이동합니다.">
									<button class="btn_password" type="button"><span class="sr_only">입력된 비밀번호 확인</span></button>
								</div>
								<div class="form_btns">
									<a href="javascript:;" id="login" class="btn_lg_primary w100p">로그인</a>
								</div>
								<div class="clear">
								
									<span class="check_wrap large"><input type="checkbox" id="save_id"><label for="save_id">아이디 저장</label></span>
									<div class="member_menu">
										<a href="/customer/signup">회원가입</a><a href="/customer/find/find-id">아이디 찾기</a><a href="/customer/find/find-pwd">비밀번호 찾기</a>
									</div>
								</div>
							</fieldset>
						</form>
					</div>
					<div class="tab_cont">
						<h3 class="sr_only">휴대폰 로그인</h3>
						<form id="mobile">
							<fieldset class="form" id="req-field">
								<legend class="sr_only">로그인</legend>
								<div class="input_wrap">
									<input type="text" title="이름 입력" name="custNm" placeholder="이름을 입력하세요" required="required"
				 							data-msg-required="이름을 입력해 주세요. 이름 입력란으로 이동합니다." user-name="user-name"/>
								</div>
								<div class="input_group">
									<div>
										<div class="select_wrap">
										<select name="phoneNumber1" required="required" title="휴대폰 사업자 식별번호 선택" data-msg-required="휴대전화 사업자 식별번호를 입력해주세요.">
											<option value="010">010</option>
											<option value="011">011</option>
											<option value="016">016</option>
											<option value="017">017</option>
											<option value="018">018</option>
											<option value="019">019</option>
										</select>
										</div>
									</div>
									<div class="gap"></div>
									<div class="input_wrap"><input type="tel" name="phoneNumber2" required="required" title="휴대폰 번호 가운데자리 입력" maxlength="4" placeholder="0000" data-msg-required="휴대폰번호를 입력해 주세요."></div>
									<div class="gap"></div>
									<div class="input_wrap"><input type="tel" name="phoneNumber3" required="required" title="휴대폰 번호 끝자리 입력" maxlength="4" placeholder="0000" data-msg-required="휴대폰번호를 입력해 주세요."></div>
								</div>
								<div class="form_btns">
									<a href="javascript:;" class="btn_login" id="send-sms">인증번호 발송</a>
								</div>
								<div class="clear">
									 <span></span>
									<div class="member_menu">
										<a href="/customer/signup">회원가입</a><a href="/customer/find/find-id">아이디 찾기</a><a href="/customer/find/find-pwd">비밀번호 찾기</a>
									</div>
								</div>
							</fieldset>
							<fieldset class="form" style="display:none;" id="rsp-field">
								<div class="input_wrap"><input type="tel" name="smsNum" required="required" title="인증번호를 입력하세요." maxlength="8" placeholder="인증번호를 입력하세요." data-msg-required="인증번호를 입력해 주세요."></div>
								<div class="gap"></div>
								<div class="time_box"><span class="conf_time">남은시간 : 0<span name="timer">3:00</span></span></div>
								<div class="result_box">
									<p class="err_msg" id="err_cert" style="display: none;">인증번호를 <span id="err_count">1</span>회 잘못 입력하였습니다.</p>
									<p style="display: none;" id="time-over" class="err_msg">인증 시간이 초과되었습니다.</p>
									<a href="javascript:;" id="btn_re_send_sms">인증번호 재전송</a>
								</div>
								<ul class="noti">
									<li>신규 고객님의 경우 인증후 회원가입이 됩니다.</li>
									<li>본인인증후 ID 존재시 해당 ID로 자동 로그인되며,</li>
									<li>본인인증 5회 실패시 당일 휴대폰 간편로그인이 제한됩니다.</li>
								</ul>
								<div class="form_btns">
									<a href="#none" id="complete2" class="btn_login">인증하기</a>
								</div>
							</fieldset>
						</form>
					</div>
					<div class="tab_cont">
						<h3 class="sr_only">비회원(주문조회)</h3>
						<fieldset class="form">
							<legend class="sr_only">로그인</legend>
							<div class="input_wrap">
								<input type="text" title="주문번호 입력" name="ordNo" placeholder="주문번호를 입력하세요">
							</div>
							<div class="input_group">
								<div>
									<div class="select_wrap">
										<select name="ordPhoneNumber1" required="required" title="휴대폰 사업자 식별번호 선택" data-msg-required="휴대전화 사업자 식별번호를 입력해주세요.">
											<option value="010">010</option>
											<option value="011">011</option>
											<option value="016">016</option>
											<option value="017">017</option>
											<option value="018">018</option>
											<option value="019">019</option>
										</select>
									</div>
								</div>
								<div class="gap"></div>
								<div class="input_wrap"><input type="tel" name="ordPhoneNumber2" title="휴대폰 번호 가운데자리 입력" maxlength="4" placeholder="0000"></div>
								<div class="gap"></div>
								<div class="input_wrap"><input type="tel" name="ordPhoneNumber3" title="휴대폰 번호 끝자리 입력" maxlength="4" placeholder="000"></div>
							</div>
							<div class="form_btns">
								<a href="javascript:;" onclick="nomember()" class="btn_login">로그인</a>
							</div>
							<p class="text">비회원 구매시, 포인트 적립이나 쿠폰할인 등의 혜택이 적용되지 않습니다. <br><a href="/customer/signup" class="link"><b>아직 회원이 아니세요?</b><I class="ico_arr"></I></a></p>
						</fieldset>
					</div>
				</div>
			</div>
			<!--/* sns 로그인 */-->
			<div class="sns_log">
				<button target="_blank" onclick="naverLogin()" id="naver_id_login" class="btn_lg_bordered w100p" type="button"><i class="ico_naver"></i><span>네이버로 로그인</span><i class="ico_navi next"></i></button>
				<button class="btn_lg_bordered w100p" onclick="facebookLogin()" type="button"><i class="ico_facebook"></i><span>페이스북으로 로그인</span><i class="ico_navi next"></i></button>
				<button onclick="kakaoLogin()" class="btn_lg_bordered w100p" type="button"><i class="ico_kakao"></i><span>카카오톡으로 로그인</span><i class="ico_navi next"></i></button>
			</div>
		</div>
	</div>
</div>

<!--/* 하단 js등을 실행하는 마지막 영역 */-->
<th:block ap:fragment="layout-endpoint">

<style>
.time_box {
    padding: 15px;
    font-size: 18px;
    color: #000;
    border: 1px solid #d1d1d6;
    background: white;
}
.result_box {
    position: relative;
    padding-top: 10px;
    text-align: right;
}
.result_box a {
    color: #000;
    font-size: 15px;
    border-bottom: 1px solid #000;
}
.result_box .err_msg {
    position: absolute;
    left: 0;
    top: 5px;
    padding: 6px 0 8px;
    font-size: 15px;
    color: #7052ce;
}
.noti {
    padding: 20px 0;
    font-size: 14px;
    color: #888;
}
</style>
  <script type="text/javascript" src="https://static.nid.naver.com/js/naverLogin_implicit-1.0.3.js" charset="utf-8"></script>
  <script type="application/javascript">
  $('#send-sms, #btn_re_send_sms').on('click', function() {
	    if ($(this).attr('disabled') == 'disabled') return;
	    sendSms();
	    return false;
	});
	$('#complete2').on('click', function() {
	    if (!t.isRunning()) {
	        AP.modal.alert("입력시간 초과했습니다. 인증번호 재전송 버튼을 눌러 인증 절차를 다시 진행하십시오.");
	        return;
	    }
	    loginProcess2();
	    return false;
	});

	var def_Time = 3,
	    def_TimeCnt = 3,
	    t = new AP.common.timeCountDown(def_Time, function() {
	        $('.result_box p').hide();
	        $('#time-over').show();
	    }),
	    certTimeCnt = 0,
	    extTimeCnt = 0;


	var incsNo;

	function sendSms() {
	    var $form = $('form#mobile');
	    $form.validate().settings.ignore = "[name=smsNum]";
	    if ($form.valid()) {
	        $('#send-sms').attr("disabled", "disabled");

	        AP.api.mobileLoginRequest({}, AP.common.getFormData($form)).done(function(data) {
	            //성공
	            if (data) {
	                incsNo = data.incsNo;
	                AP.modal.alert("인증번호가 전송되었습니다.");
	                $('#req-field').hide();
	                $('#rsp-field').show();
	                certTimeCnt = 2;
	                if (t.isRunning()) {
	                    t.stop();
	                }
	                t.start();

	            } else {
		            $("#send-sms").removeAttr("disabled");
	                AP.modal.alert("[ajax.done]실패")
	            }
	        }).fail(function(xhr, textStatus, errorThrown) {
	            $("#send-sms").removeAttr("disabled");

	            if (xhr.errorCode == 0) {
	                AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
	            } else if (xhr.errorCode == 'EAPI001') {
	                var contents = new Object();
	                contents.title = "인증실패";
	                contents.contents = data.message;
	                contents.confirmLabel = "확인";
	                AP.modal.info(contents).addListener('modal-close', function(e) {});
	            } else {
	                AP.modal.alert(xhr.errorMessage)
	            }
	        }).always(function() {
	            //성공, 실패
	        });
	    }
	}

	function loginProcess2() {
	    var $form = $('form#mobile');
	    $form.validate().settings.ignore = "";
	    if ($form.valid()) {

	        $("#complete").attr("disabled", "disabled");
	        AP.api.mobileLogin({}, {
	            'incsNo': incsNo,
	            'smsNum': $('[name=smsNum]').val()

	        }, AP.common.getFormData($form)).done(function(data) {

	            if (data.sleep == 'Y') {
		            $("#complete").removeAttr("disabled");
	                var contents = new Object();
	                contents.title = "알림";
	                contents.contents = data.message;
	                contents.confirmLabel = data.message;
	                AP.modal.info(contents).addListener('modal-close', function(e) {
	                    location.href = "/customer/signup";
	                });

	            } else if (data.changePw == 'Y') {
	                var contents = new Object();
	                contents.title = "알림";
	                contents.contents = data.message;
	                contents.cancelLabel = "다음에 변경";
	                contents.confirmLabel = "비밀번호 변경";

	                AP.modal.info(contents).addListener('modal-close', function(e) {
	                    if (e.closeType == 'close' || e.closeType == 'cancel') {
	                        location.href = returnUrl;
	                    } else if (e.closeType == 'confirm') {
	                        location.href = '/my/page/info/changeUserInfo';
	                    }
	                    console.log(e.closeType); //close, confirm, cancel
	                });
	            } else {
	                loginComplete();
	            }

	        }).fail(function(xhr, textStatus, errorThrown) {
	            $("#complete").removeAttr("disabled");
	            if (xhr.errorCode == 0) {
	                AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
	            } else if (xhr.errorCode == 401) {
	                $('.result_box p').hide();
	                $('#err_cert').show();
	                $('#err_count').html(xhr.responseJSON.dailyFailureCount);
	            } else if (xhr.errorCode == 'ESAL062') {
	                AP.modal.alert("일일 인증실패 횟수를 초과했습니다.");
	            } else if (xhr.errorCode == 'EXTRA') {

	                if (xhr.responseJSON.cs == 1) {

	                    $.get("/customer/popup?pageId=8", function(data) {

	                        var contents = new Object();
	                        contents.contents = data;
	                        var modal = AP.modal.info(contents);
	                        var $modalEl = modal.getElement(); //jquery object
	                        $modalEl.find('.term').click(function() {
	                            AP.modal.agreeTerms({
	                                title: '에뛰드 사이트 이용 약관',
	                                displayCode: 'ET001'
	                            });
	                        });


	                        $modalEl.find('[name=ET001]').on('click', function() {
	                        	if($(this).prop('checked')) {
	                        		$('.btn_lg_secondary').addClass('btn_lg_primary').removeClass('btn_lg_secondary');
	                        	} else {
	                        		$('.btn_lg_primary').addClass('btn_lg_secondary').removeClass('btn_lg_primary');
	                        	}
	                        });
	                        $modalEl.find('input').on('click', function() {
	                            if ($(this).attr('id') == 'choice0') {

	                                $modalEl.find("input[type=checkbox]").prop('checked', $(this).prop('checked'));

		                        	if($(this).prop('checked')) {
		                        		$('.btn_lg_secondary').addClass('btn_lg_primary').removeClass('btn_lg_secondary');
		                        	} else {
		                        		$('.btn_lg_primary').addClass('btn_lg_secondary').removeClass('btn_lg_primary');
		                        	}
		                        	
	                            } else {

	                                var isAll = true;

	                                $modalEl.find("input[type=checkbox]").each(function() {
	                                    if ($(this).attr('id') != 'choice0') {
	                                        if (!$(this).prop('checked')) {
	                                            isAll = false;
	                                        }
	                                    }
	                                });

	                                $('#choice0').prop('checked', isAll);
	                            }
	                        });

	                        $modalEl.find(".btn_lg_secondary").click(function() {

	                            if (!$modalEl.find('[name=ET001]').prop('checked')) {
	                                AP.modal.alert("필수 약관에 동의해주셔야 합니다.");
	                                return;
	                            }

	                            AP.api.simpleJoin({}, {
	                                terms: $modalEl.find('[name=ET001]').prop('checked'),
	                                sms: $modalEl.find('[name=SMS]').prop('checked'),
	                                email: $modalEl.find('[name=Email]').prop('checked')
	                            }).done(function(data) {
	                                location.href = "/customer/joinComplete";
	                            }).fail(function(xhr, textStatus, errorThrown) {
	                                AP.modal.alert("예상치 못한 오류가 발생하여 회원가입에 실패했습니다. 관리자에게 문의해 주세요.");
	                            }).always(function() {
	                                //성공, 실패
	                            });

	                        });
	                    });
	                } else if (xhr.responseJSON.cs == 2) {

	                    $.get("/customer/popup?pageId=4&userId1=" + xhr.responseJSON.userId, function(data) {

	                        var contents = new Object();
	                        contents.contents = data;
	                        var modal = AP.modal.info(contents);
	                        var $modalEl = modal.getElement(); //jquery object

	                        $modalEl.find(".btn_md_primary").click(function() {
	                            modal.close();

	                        });
	                    });
	                } else if (xhr.responseJSON.cs == 3) {

	                    $.get("/customer/popup?pageId=2", function(data) {

	                        var contents = new Object();
	                        contents.contents = data;
	                        var modal = AP.modal.info(contents);
	                        var $modalEl = modal.getElement(); //jquery object

	                        $modalEl.find(".btn_md_primary").click(function() {
	                            location.href = "/customer/signup?oldId=" + xhr.responseJSON.userId;

	                        });
	                    });
	                }

	            } else {
	                AP.modal.alert(xhr.errorMessage)
	            }
	        }).always(function() {
	            //성공, 실패
	        });
	    }
	}


	$('input[type=tel]').keydown(function(event) {
	    if (event.keyCode) {
	        var code = event.keyCode;
	        if ((code >= 48 && code <= 57) || (code >= 96 && code <= 105) || (code == 8) || (code == 9) || (code == 46)) {
	            return true;
	        } else {
	            return false;
	        }
	    } else if (e.which) {
	        var code = e.which;
	        if ((code >= 48 && code <= 57) || (code >= 96 && code <= 105) || (code == 8) || (code == 9) || (code == 46)) {
	            return true;
	        } else {
	            return false;
	        }
	    }
	});
	$('input[type=tel]').keyup(function(event) {
	    event = event || window.event;
	    var keyID = (event.which) ? event.which : event.keyCode;
	    if (keyID == 8 || keyID == 46 || keyID == 37 || keyID == 39)
	        return;
	    else
	        event.target.value = event.target.value.replace(/[^0-9]/g, "");
	});

	$('.btn_password').mousedown(function() {
	    $('[name=userPwdEc]').attr('type', 'text');

	});
	$('.btn_password').hover(function() {

	}, function() {
	    $('[name=userPwdEc]').attr('type', 'password');

	});
	$('.btn_password').mouseup(function() {
	    $('[name=userPwdEc]').attr('type', 'password');

	});

	$('.btn_del').click(function() {
	    $(this).parent().find('input').val(null);
	});
	if (AP.common.getCookie('is-user-id')) {
	    var $id = $('[name=chcsNo]');
	    if (AP.common.getCookie('user-id', null, 1) != 'on') {
	        $id.val(AP.common.getCookie('user-id', null, 1));
	        $id.parents().find('.placeholder').css('display', 'none');
	        $('#save_id').prop('checked', true);
	    }
	}
	$('#login').on('click', function() {
	    if ($(this).attr('disabled') == 'disabled') return;
	    loginProcess();
	    return false;
	});

	var returnUrl = '[[${returnUrl}]]';
	if (returnUrl == '') returnUrl = "/main";

	$('form [name=redirectUrl]').val(returnUrl);
	var t;

	function loginProcess() {
	    var $form = $('form#main');
	    if ($form.valid()) {
	        if (!$("[name=chcsNo]").val() || !$("[name=userPwdEc]").val()) {
	            return;
	        }

	        $("#login").attr("disabled", "disabled");
	        $("#login").addClass("disabled");
	        AP.api.doLogin({}, AP.common.getFormData($form)).done(function(data) {

	            if (data.sleep == 'Y') {
		            $("#login").removeAttr("disabled");
		            $("#login").removeClass("disabled");
	                var contents = new Object();
	                contents.title = "알림";
	                contents.contents = data.message;
	                contents.confirmLabel = data.message;
	                AP.modal.info(contents).addListener('modal-close', function(e) {
	                    location.href = "/customer/signup";
	                });

	            } else if (data.changePw == 'Y') {
	                var contents = new Object();
	                contents.title = "알림";
	                contents.contents = data.message;
	                contents.cancelLabel = "다음에 변경";
	                contents.confirmLabel = "비밀번호 변경";

	                AP.modal.info(contents).addListener('modal-close', function(e) {
	                    if (e.closeType == 'close' || e.closeType == 'cancel') {
	                        location.href = returnUrl;
	                    } else if (e.closeType == 'confirm') {
	                        changePassword();
	                    }
	                    console.log(e.closeType); //close, confirm, cancel
	                });
	            } else {
	                if ($('#save_id').prop("checked")) {
	                    AP.common.setCookie('user-id', '', 0);
	                    AP.common.setCookie('is-user-id', '', 0);
	                    AP.common.setCookie('user-id', $('[name=chcsNo]').val(), 2592000000);
	                    AP.common.setCookie('is-user-id', $('#save_id').val(), 2592000000);
	                } else {
	                    AP.common.setCookie('user-id', '', 0);
	                    AP.common.setCookie('is-user-id', '', 0);
	                }
	                loginComplete();

	            }

	        }).fail(function(xhr, textStatus, errorThrown) {
	            $("#login").removeAttr("disabled");
	            $("#login").removeClass("disabled");
	            if (xhr.errorCode == 0) {
	                AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
	            } else if (xhr.errorCode == 'ESAL002') {
	                AP.modal.alert("아이디 또는 비밀번호가 일치하지 않습니다. 다시 입력해주세요.");
	            } else if (xhr.errorCode == 'ESAL003') {
	                if (xhr.responseJSON.isLock == true) {

	                    var contents = new Object();
	                    contents.title = "알림";
	                    contents.contents = "비밀번호를 5회 잘못 입력하셨습니다.\n\n개인정보보호를 위해\n30분간 로그인이 불가능합니다.";
	                    contents.cancelLabel = "확인";
	                    AP.modal.info(contents);

	                } else {
	                    $.get("/customer/popup?pageId=5", function(data) {

	                        var contents = new Object();
	                        contents.contents = data;
	                        var modal = AP.modal.info(contents);
	                        var $modalEl = modal.getElement(); //jquery object
	                        if (!t.isRunning()) {
	                            t = new AP.common.timeCountDown(xhr.responseJSON.lockReleaseDate, function() {});
	                            t.start();
	                        }
	                        $modalEl.find(".btn_md_primary").click(function() {
	                            t.stop;
	                            modal.close();
	                        });
	                    });
	                }

	            } else if (xhr.errorCode == 'EXTRA') {

	                if (xhr.responseJSON.cs == 1) {

	                    $.get("/customer/popup?pageId=8", function(data) {

	                        var contents = new Object();
	                        contents.contents = data;
	                        var modal = AP.modal.info(contents);
	                        var $modalEl = modal.getElement(); //jquery object
	                        $modalEl.find('.term').click(function() {
	                            AP.modal.agreeTerms({
	                                title: '에뛰드 사이트 이용 약관',
	                                displayCode: 'ET001'
	                            });
	                        });


	                        $modalEl.find('[name=ET001]').on('click', function() {
	                        	if($(this).prop('checked')) {
	                        		$('.btn_lg_secondary').addClass('btn_lg_primary').removeClass('btn_lg_secondary');
	                        	} else {
	                        		$('.btn_lg_primary').addClass('btn_lg_secondary').removeClass('btn_lg_primary');
	                        	}
	                        });
	                        $modalEl.find('input').on('click', function() {
	                            if ($(this).attr('id') == 'choice0') {

	                                $modalEl.find("input[type=checkbox]").prop('checked', $(this).prop('checked'));

		                        	if($(this).prop('checked')) {
		                        		$('.btn_lg_secondary').addClass('btn_lg_primary').removeClass('btn_lg_secondary');
		                        	} else {
		                        		$('.btn_lg_primary').addClass('btn_lg_secondary').removeClass('btn_lg_primary');
		                        	}
		                        	
	                            } else {

	                                var isAll = true;

	                                $modalEl.find("input[type=checkbox]").each(function() {
	                                    if ($(this).attr('id') != 'choice0') {
	                                        if (!$(this).prop('checked')) {
	                                            isAll = false;
	                                        }
	                                    }
	                                });

	                                $('#choice0').prop('checked', isAll);
	                            }
	                        });

	                        $modalEl.find(".btn_lg_secondary").click(function() {

	                            if (!$modalEl.find('[name=ET001]').prop('checked')) {
	                                AP.modal.alert("필수 약관에 동의해주셔야 합니다.");
	                                return;
	                            }

	                            AP.api.simpleJoin({}, {
	                                terms: $modalEl.find('[name=ET001]').prop('checked'),
	                                sms: $modalEl.find('[name=SMS]').prop('checked'),
	                                email: $modalEl.find('[name=Email]').prop('checked')
	                            }).done(function(data) {
	                                location.href = "/customer/joinComplete";
	                            }).fail(function(xhr, textStatus, errorThrown) {
	                                AP.modal.alert("예상치 못한 오류가 발생하여 회원가입에 실패했습니다. 관리자에게 문의해 주세요.");
	                            }).always(function() {
	                                //성공, 실패
	                            });

	                        });
	                    });
	                } else if (xhr.responseJSON.cs == 2) {

	                    $.get("/customer/popup?pageId=4&userId1=" + xhr.responseJSON.userId, function(data) {

	                        var contents = new Object();
	                        contents.contents = data;
	                        var modal = AP.modal.info(contents);
	                        var $modalEl = modal.getElement(); //jquery object

	                        $modalEl.find(".btn_md_primary").click(function() {
	                            modal.close();

	                        });
	                    });
	                } else if (xhr.responseJSON.cs == 3) {

	                    $.get("/customer/popup?pageId=2", function(data) {

	                        var contents = new Object();
	                        contents.contents = data;
	                        var modal = AP.modal.info(contents);
	                        var $modalEl = modal.getElement(); //jquery object

	                        $modalEl.find(".btn_md_primary").click(function() {
	                            location.href = "/customer/signup?oldId=" + xhr.responseJSON.userId;

	                        });
	                    });
	                }

	            } else {
	                AP.modal.alert(xhr.errorMessage)
	            }
	        }).always(function() {
	            //성공, 실패
	        });
	    }
	}

	//전환가입 안내
	function changeInfoModal() {
	    var contents = new Object();
	    contents.title = "고객님! 아모레퍼시픽<br>통합 멤버십으로 전환하세요!";
	    contents.contents = "<p class=\"text_center\">아모레퍼시픽 통합멤버십 회원이 되시면,</p>\n" +
	        "                            <br>\n" +
	        "                            <ul class=\"list_bullet\">\n" +
	        "                            \t<li><span>1)</span> 에뛰드하우스 및 자회사 등 아모레퍼시픽계열<br>모든 쇼핑몰 한 아이디로 간편하게 이용할 수 있습니다.</li>\n" +
	        "                            \t<li><span>2)</span> 하나의 아이디로 편리하게, 통합멤버십(뷰티포인트) 적립 및 다양한 서비스와 혜택을 누리실 수 있습니다.</li>\n" +
	        "                            </ul>";
	    contents.cancelLabel = "취소";
	    contents.confirmLabel = "전환가입";

	    AP.modal.info(contents).addListener('modal-close', function(e) {
	        if (e.closeType == 'close' || e.closeType == 'cancel') {} else if (e.closeType == 'confirm') {
	            location.href = "/conversionSignup";
	        }
	    });
	}

	function changePassword() {


	    $.get("/my/page/info/changePwdForm", function(data) {
	        /**
	         * 동적으로 생성된 modal의 Node Element 접근하기
	         * alert, confirm, info 모두 동일
	         */

	        var contents = new Object();
	        contents.contents = data;
	        var modal = AP.modal.info(contents);
	        var $modalEl = modal.getElement(); //jquery object

	        $(".layer_close").click(function() {
	            location.href = returnUrl;
	        });
	        $("#cancel-change-pwd").click(function() {
	            location.href = returnUrl;
	        });

	        $("#submit-change-pwd").click(function() {
	            if ($("#pw-change-form").valid()) {
	                if ($("#pass1").val() != $("#pass2").val()) {
	                    AP.modal.alert("새 비밀번호가 일치하지 않습니다.");
	                    return false;
	                }

	                AP.api.changePwd2({}, AP.common.getFormData($('#pw-change-form'))).done(function(data) {
	                    AP.modal.alert("비밀번호가 변경되었습니다.").addListener('modal-close', function(e) {
	                        location.href = returnUrl;
	                    });
	                }).fail(function(xhr, textStatus, errorThrown) {
	                    if (xhr.errorCode == 0) {
	                        AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
	                    } else if (xhr.errorCode == 'EAPI005') {
	                        AP.modal.alert("아이디 또는 비밀번호가 일치하지 않습니다. 다시 입력해주세요.");
	                    } else {
	                        AP.modal.alert(xhr.errorMessage)
	                    }
	                }).always(function() {
	                    //성공, 실패
	                });
	            }
	        });

	    });
	}

	//카카오으로 로그인
	function snsKakao() {
	    Kakao.Auth.login({
	        persistRefreshToken: true,
	        success: function(authObj) {
	            Kakao.Auth.setAccessToken(authObj.access_token);

	            Kakao.API.request({
	                url: '/v1/user/me',
	                success: function(res) {

	                    var indexed_array = {};
	                    indexed_array['snsName'] = 'Kakao';
	                    indexed_array['id'] = res.id;
	                    $.ajax({
	                        type: "POST",
	                        url: "/login/snsloginProcess",
	                        data: indexed_array,
	                        success: function(data) {
	                            if (data.state == 'success') {
	                                if (data.isLinked) {
	                                    window.location.href = returnUrl;
	                                } else {
	                                    location.href = "/login/snsLinkPage";
	                                    window.close();
	                                }
	                            }
	                            //성공
	                        },
	                        dataType: "json"
	                    });
	                },
	                fail: function(error) {
	                    alert(JSON.stringify(error));
	                }
	            });


	        },
	        fail: function(err) {
	            console.log(JSON.stringify(err));
	            alert(JSON.stringify(err));
	        }
	    });
	}

	//페이스북으로 로그인
	window.fbAsyncInit = function() {
	    FB.init({
	        appId: '[[${@environment.getProperty('facebook.key')}]]',
	        cookie: true,
	        xfbml: true,
	        version: 'v2.11'
	    });

	    FB.AppEvents.logPageView();

	};

	(function(d, s, id) {
	    var js, fjs = d.getElementsByTagName(s)[0];
	    if (d.getElementById(id)) {
	        return;
	    }
	    js = d.createElement(s);
	    js.id = id;
	    js.src = "https://connect.facebook.net/en_US/sdk.js";
	    fjs.parentNode.insertBefore(js, fjs);

	}(document, 'script', 'facebook-jssdk'));

	function facebookLogin() {

	    FB.login(function(response) {
	        //statusChangeCallback(response);   -- FB 로그인 취소시, 무한루프에 빠지게됨
	        if (response.status === 'connected') {
	            // 페이스북과 앱에 같이 로그인되어 있다.
	            $("#accessToken").val(response.authResponse.accessToken);
	            fncFBCallback(response.authResponse.accessToken);
	        } else if (response.status === 'not_authorized') {
	            // 페이스북에는 로그인 되어있으나, 앱에는 로그인 되어있지 않다.
	            AP.modal.alert('Facebook 계정 설정에서 해당 어플리케이션이 인가되지 않았습니다.\n다시 로그인 버튼을 클릭후, 어플리케이션 사용을 승인하여 주십시오.');
	        } else {
	            // 페이스북에 로그인이 되어있지 않아서, 앱에 로그인 되어있는지 불명확하다.
	            AP.modal.alert('Facebook 에 로그인되지 않았습니다.');
	        }
	    });
	}

	function naverLogin() {
	    window.open('https://nid.naver.com/oauth2.0/authorize?response_type=token&client_id=[[${@environment.getProperty('naver.key')}]]&state=[[${state}]]&redirect_uri=' + location.href.replace('login', 'navercallback').split('#')[0], 'naverloginpop', 'titlebar=1, resizable=1, scrollbars=yes, width=600, height=550');
	    return false;
	}

	function kakaoLogin() {
		var returl = location.href.replace('login', '').split('#')[0] + 'kakaocallback';
		AP.api.saveUrl({}, {
			url:returl
		}).done(function(data) {
		    window.open('https://kauth.kakao.com/oauth/authorize?client_id=[[${@environment.getProperty('kakao.restkey')}]]&response_type=code&redirect_uri=' + returl, 'kakaologinpop', 'titlebar=1, resizable=1, scrollbars=yes, width=600, height=550');
        }).fail(function(xhr, textStatus, errorThrown) {
			AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
        }).always(function() {
            $("#send-sms").removeAttr("disabled");
            //성공, 실패
        });
		
	    return false
	}

	function fncFBCallback(token) {
	    FB.api('/me', {
	        fields: 'email, birthday, name'
	    }, function(response) {

	        var indexed_array = {};
	        indexed_array['snsName'] = 'Facebook';
	        indexed_array['id'] = response.id;
	        indexed_array['accessToken'] = token;

	        $.ajax({
	            type: "POST",
	            url: "/login/snsloginProcess",
	            data: indexed_array,
	            success: function(data) {
	                if (data.isLinked) {
	                    nbSuccess(data);
	                } else {
	                    doSnsLogin();
	                }
	                //성공
	            },
	            dataType: "json"
	        });
	    });
	}

	function nbSuccess(data) {

	    if (data.sleep == 'Y') {
	        location.href = "/sleepUser";

	    } else if (data.old == 'Y') {

	    } else if (data.changePw == 'Y') {
	        var contents = new Object();
	        contents.title = "알림";
	        contents.contents = "고객님!<br>" +
	            "비밀번호를 3개월동안 변경하지 않으셨습니다.<br><br>" +
	            "개인정보보호를 위해<br>비밀번호를 변경해주세요.";
	        contents.cancelLabel = "다음에 변경";
	        contents.confirmLabel = "비밀번호 변경";

	        AP.modal.info(contents).addListener('modal-close', function(e) {
	            if (e.closeType == 'close' || e.closeType == 'cancel') {
	                location.href = returnUrl;
	            } else if (e.closeType == 'confirm') {
	                changePassword();
	            }
	            console.log(e.closeType); //close, confirm, cancel
	        });
	    } else {
	        loginComplete();
	    }
	}

	function doSnsLogin() {

	    $.get("/snsLinkLoginForm", function(data) {

	        var contents = new Object();
	        contents.contents = data;
	        var modal = AP.modal.info(contents);
	        var $modalEl = modal.getElement(); //jquery object

	        $(".layer_close").click(function() {
	            modal.close();
	        });

	        $('#sns-login').click(function() {
	            var $form = $modalEl.find('#form');
	            if ($form.valid()) {

	                AP.api.doLoginLink({}, AP.common.getFormData($form)).done(function(data) {
	                    //성공
	                    var returnUrl = "/main"
	                    if (data.returnUrl)
	                        returnUrl = data.returnUrl;

	                    if (data.sleep == 'Y') {
	                        location.href = "/sleepUser";

	                    } else if (data.old == 'Y') {
	                        var contents = new Object();
	                        contents.title = "[[#{customer.login.changeIntegratedTitle}]]";
	                        contents.contents = "[[#{customer.login.changeIntegratedContent}]]";
	                        contents.cancelLabel = "[[#{common.cancel}]]";
	                        contents.confirmLabel = "[[#{customer.login.changeIntegrated}]]";

	                        AP.modal.info(contents).addListener('modal-close', function(e) {
	                            if (e.closeType == 'close' || e.closeType == 'cancel') {} else if (e.closeType == 'confirm') {
	                                location.href = "/customer/signup";
	                            }
	                            console.log(e.closeType); //close, confirm, cancel
	                        });
	                    } else if (data.changePw == 'Y') {
	                        var contents = new Object();
	                        contents.title = "[[#{common.alert}]]";
	                        contents.contents = "고객님!<br>" +
	                            "비밀번호를 3개월동안 변경하지 않으셨습니다.<br><br>" +
	                            "개인정보보호를 위해<br>비밀번호를 변경해주세요.";
	                        contents.cancelLabel = "다음에 변경";
	                        contents.confirmLabel = "비밀번호 변경";

	                        AP.modal.info(contents).addListener('modal-close', function(e) {
	                            if (e.closeType == 'close' || e.closeType == 'cancel') {
	                                location.href = returnUrl;
	                            } else if (e.closeType == 'confirm') {
	                                location.href = "/customer/signup";
	                            }
	                            console.log(e.closeType); //close, confirm, cancel
	                        });
	                    } else {
	                        loginComplete();
	                    }

	                }).fail(function(xhr, textStatus, errorThrown) {
	                    $("#login").removeAttr("disabled");
	                    if (xhr.errorCode == 0) {
	                        AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
	                    } else if (xhr.errorCode == 'EAPI005') {
	                        AP.modal.alert("아이디 또는 비밀번호가 일치하지 않습니다. 다시 입력해주세요.");
	                    } else {
	                        AP.modal.alert(xhr.errorMessage)
	                    }
	                }).always(function() {
	                    //성공, 실패
	                });

	            }
	        });

	    });
	}

	function loginComplete() {
        if ($('#sub').attr('method') == 'POSTs')
            $('#sub').submit();
        else
            location.href = $('#sub').attr('action').replace('?isRequiredLogin=true', '');

	}

	function nomember() {

	    AP.api.checkOrder({}, {
	    	ordNo: $('[name=ordNo]').val(),
	    	phoneNo: $('[name=ordPhoneNumber1]').val() + $('[name=ordPhoneNumber2]').val() + $('[name=ordPhoneNumber3]').val()
	    }).done(function(data) {
			post_goto('/non/order/detail/' + $('[name=ordNo]').val() , {'phoneNo': $('[name=ordPhoneNumber1]').val() + $('[name=ordPhoneNumber2]').val() + $('[name=ordPhoneNumber3]').val()});
	    }).fail(function(xhr, textStatus, errorThrown) {
	        AP.modal.alert(xhr.errorMessage)
	    }).always(function() {
	        //성공, 실패
	    });
	}
	</script>
</th:block>

</body>
</html>
