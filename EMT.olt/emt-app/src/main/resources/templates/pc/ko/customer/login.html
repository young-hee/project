<html ap:decorate="~{layout/default}">

<body>
        <!-- #ap_container -->
        <div ap:fragment="layout-contents">
        	<!-- page title -->
            <th:block ap:replace="~{common/fragment/contents-page-title}"/>
            <!-- // page title -->
            <!-- page contents -->
			<form th:method="${method}" id="sub" th:action="${returnUrl}">
				<th:block th:if="${pVal}" th:each="item : ${pVal}">
					<th:block th:if="${pVal}" th:each="item : ${pVal}">
						<input  type="hidden" th:name="${item.key}" th:value="${item.value}">
					</th:block>
				</th:block>
			</form>
            <div class="ap_contents login">
                <div class="panel">
                    <div class="panel_cont">
                        <fieldset class="form">
                            <legend class="sr_only">로그인 정보 입력</legend>
                            <div class="radio_set">
                                <span class="check_wrap"><input type="radio" name="login" id="choice1" checked><label for="choice1">회원</label></span>
                                <span class="check_wrap"><input type="radio" name="login" id="choice2"><label for="choice2">휴대폰 로그인</label></span>                                
                                <span class="check_wrap"><input type="radio" name="login" id="choice3"><label for="choice3">비회원(주문조회)</label></span>
                            </div>
                            
                           <div class="login_tab_contents">
								<!-- // 일반로그인 -->                           	
		                            <div class="login_area">
										<form id="main">
			                                <div class="input_wrap">
			                                	<input type="text" title="아이디 입력" name="chcsNo" placeholder="아이디" required="required" data-msg-required="아이디를 입력해 주세요. 아이디 입력란으로 이동합니다.">
											</div>
			                                <div class="input_wrap">
			                                	<input type="password" title="비밀번호 입력" name="userPwdEc" placeholder="비밀번호" required="required" data-msg-required="비밀번호를 입력해 주세요. 비밀번호 입력란으로 이동합니다.">
			                                </div>
			                                <div class="clear">
			                                    <div class="check_wrap"><input type="checkbox" id="save_id"><label for="save_id">아이디 저장</label></div>
			                                    <div>
			                                        <a href="/customer/find/find-id">아이디 찾기</a> │ <a href="/customer/find/find-pwd">비밀번호 찾기</a>
			                                    </div>
			                                </div>
			                                <button type="button" id="login" class="btn_primary_login">로그인</button>
			                            </form>
		                            </div>
								<!-- // 휴대폰 로그인 -->                             
	                            <div class="login_area" style="display:none;">
									<form id="mobile">
		                                <div class="input_wrap"><input type="text" title="이름 입력" name="custNm" placeholder="이름을 입력하세요" required="required"
				 							data-msg-required="이름을 입력해 주세요. 이름 입력란으로 이동합니다." user-name="user-name"/></div>
		                                <div class="input_wrap">                              
		                                    <span class="input_group input_phone">
		                                        <span class="select_wrap">
													<select name="phoneNumber1" required="required" title="휴대폰 사업자 식별번호 선택" data-msg-required="휴대전화 사업자 식별번호를 입력해주세요.">
														<option value="010">010</option>
														<option value="011">011</option>
														<option value="016">016</option>
														<option value="017">017</option>
														<option value="018">018</option>
														<option value="019">019</option>
													</select>
		                                        </span>
		                                        <span class="gap"></span>
		                                        <div class="input_wrap certification"><input type="tel" name="phoneNumber2" required="required" title="휴대폰 번호 입력" maxlength="8" placeholder="휴대폰 번호 '-'없이 입력" data-msg-required="휴대폰번호를 입력해 주세요.">                                 
		                                       		<button class="btn_round" id="send-sms" type="button">인증요청</button>
													<button class="btn_round" style="display: none;" id="btn_re_send_sms" type="button">재인증요청</button>
		                                       	</div>  
		                                    </span>      
		                                </div>
		                                 <div class="input_wrap certification">  
		                                     <div>
		                                         <div class="input_wrap">
		                                         	<input type="tel" name="smsNum" required="required" title="인증번호를 입력하세요." maxlength="8" placeholder="인증번호를 입력하세요." data-msg-required="인증번호를 입력해 주세요.">
		                                         	<em class="count" id="sms-time" name="timer">3:00</em>
		                                         	<button class="btn_round" id="complete2" type="button" disabled>인증확인</button>
		                                         </div>                                                                            
		                                     </div>                                     
		                                     <ul class="list_bullet_dot font_sl mgt10 mgb20">
		                                         <li>3분 이내에 인증번호를 입력하셔야 합니다.</li>
		                                         <li>입력 시간 초과 시 재전송 버튼을 눌러주세요.</li>
		                                     </ul>                                    
		                                </div>                                                             
		                                <div class="clear">
		                                    <div></div>
		                                    <div>
		                                        <a href="/customer/find/find-id">아이디 찾기</a> │ <a href="/customer/find/find-pwd">비밀번호 찾기</a>
		                                    </div>
		                                </div>
		                                <button type="button" id="complete3" onclick="mobileLoginComplete()" class="btn_primary_login">로그인</button>
	                                </form>
	                            </div>
								<!-- // 비회원로그인 -->                             
	                            <div class="login_area" style="display:none;">
	                            	<form>
		                                <div class="input_wrap"><input type="text" name="custNm2" title="주문자 이름 입력" placeholder="주문자 이름"></div>
		                                <div class="input_wrap"><input type="text" title="주문번호 입력" name="ordNo" placeholder="주문번호를 입력하세요"></div>
		                                <button type="button" onclick="nomember()" class="btn_primary_login">주문조회</button>
		                                <br>
	                        			<p class="text font_sl">비회원으로 구매하신 경우에만 주문조회가 가능합니다.</p>
	                       			</form>
	                            </div>
	                            
							</div>                                                 
                        </fieldset>
                        <hr class="div m20">
                        <dl class="dl_cont">
                            <dt class="h_title cont">아직도 회원이 아니세요?</dt>
                            <dd>
                                <p class="text">아모레퍼시픽계열 모든 쇼핑몰을 하나의 아이디로 편리하게, <br>통합멤버십(뷰티포인트)적립 및 다양한 서비스와 혜택을 누리세요.</p>
                                <a href="/customer/signup" class="btn_md_bordered vertical">회원가입 </a>
                            </dd>
                        </dl>
                    </div>
                </div>
                <div class="panel gray">
                    <div class="panel_cont">
                        <p class="text font_lg">SNS계정으로 간편하게 로그인 하세요.</p>
                        <ul class="ui_sns_share sns">
                            <li><a href="javascript:;" onclick="naverLogin()" class="share_btn facebook" data-sns-type="facebook">facebook</a></li>
                            <li><a href="javascript:;" onclick="facebookLogin()" class="share_btn naver_blog" data-sns-type="naver_blog">naver blog</a></li>
                            <li><a href="javascript:;" onclick="kakaoLogin()" class="share_btn url" data-sns-type="url">copy url</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        	<!-- // page contents -->
        	<!-- banner -->
            <div class="banner_area">
                <!-- slide -->
                <div class="slide" data-ix-options="view-length:1;">
                    <div class="ix-list-viewport">
                        <ul class="ix-list-items">
                            <!--/* TODO: 배너 갯수 만큼 li 생성 */-->
                            <li class="ix-list-item">
                                <!--/* TODO: background color 배너 등록시 설정 필요 */-->
                                <a href="#none" style="background:#f0adb6;">
                                    <img ap:src="@{/images/dummy/img_banner_01.jpg}" alt="배너 내용">
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="ix-controller">
                        <ul class="ix-thumbs">
                            <li class="ix-thumb"><button type="button" class="ix-btn"><!--ix-index-->번째 배너</button></li>
                        </ul>
                    </div>
                </div><!-- // slide -->
            </div>
        </div><!-- // #ap_container -->

        <!--/* 하단 js등을 실행하는 마지막 영역 */-->
        <th:block ap:fragment="layout-endpoint">

            <!--/* 예시, 적절한 위치에 옮겨 개발하세요 */-->
            <script>

            if (AP.common.getCookie('is-user-id')) {
                var $id = $('[name=chcsNo]');
                if (AP.common.getCookie('user-id', null, 1) != 'on') {
                    $id.val(AP.common.getCookie('user-id', null, 1));
                    $id.parents().find('.placeholder').css('display', 'none');
                    $('#save_id').prop('checked', true);
                }
            }
            var t2;
                //하단 베너 제어
                (function () {
                    var $banner = $( '.banner_area > .slide' ).ixSlideMax();

                    $( window ).on( 'resize', function (e) {
                        $banner.ixSlideMax( 'resize' );
                    });
                })();
            	//로그인 탭메뉴
				$(document).ready(function(){ 				
				 var loginContent = $(".login_tab_contents > .login_area");
				 $("input[type='radio']").click(function(){
					loginContent.hide();
					loginContent.eq($("input[type='radio']").index(this)).show();
				 });
				});
            	

				  $('#send-sms, #btn_re_send_sms').on('click', function() {
					    if ($(this).attr('disabled') == 'disabled') return;
					    sendSms();
					    return false;
					});
					$('#complete2').on('click', function() {
					    if (!t.isRunning()) {
					        AP.modal.alert("입력시간 초과했습니다. 인증번호 재전송 버튼을 눌러 인증 절차를 다시 진행하십시오.");
					        return;
					    }
					    loginProcess2();
					    return false;
					});

					var def_Time = 3,
					    def_TimeCnt = 3,
					    t = new AP.common.timeCountDown(def_Time, function() {
					        $('.result_box p').hide();
					        $('#time-over').show();
					    }, '#sms-time'),
					    certTimeCnt = 0,
					    extTimeCnt = 0;


					var incsNo;

					function sendSms() {
					    var $form = $('form#mobile');
					    $form.validate().settings.ignore = "[name=smsNum]";
					    if ($form.valid()) {
					        $('#send-sms').attr("disabled", "disabled");

					        AP.api.mobileLoginRequest({}, AP.common.getFormData($form)).done(function(data) {
					            //성공
					            if (data) {
					                incsNo = data.incsNo;
					                AP.modal.alert("인증번호가 전송되었습니다.");
					                $('#send-sms').hide();
					                $('#btn_re_send_sms').show();
					                $('#complete2').removeAttr('disabled');
					                certTimeCnt = 2;
					                if (t.isRunning()) {
					                    t.stop();
					                }
					                t.start();

					            } else {
						            $("#send-sms").removeAttr("disabled");
					                AP.modal.alert("[ajax.done]실패")
					            }
					        }).fail(function(xhr, textStatus, errorThrown) {
					            $("#send-sms").removeAttr("disabled");

					            if (xhr.errorCode == 0) {
					                AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
					            } else if (xhr.errorCode == 'EAPI001') {
					                var contents = new Object();
					                contents.title = "인증실패";
					                contents.contents = xhr.errorMessage;
					                contents.confirmLabel = "확인";
					                AP.modal.info(contents).addListener('modal-close', function(e) {});
					            } else {
					                AP.modal.alert(xhr.errorMessage)
					            }
					        }).always(function() {
					            //성공, 실패
					        });
					    }
					}
					var isLoginComplete = false;
					
					function mobileLoginComplete() {
						if(!isLoginComplete) {
							AP.modal.alert("휴대폰 인증이 필요합니다.");
							return;
						}

				        $("#complete3").attr("disabled", "disabled");
				        AP.api.mobileLoginComplete({}, {}).done(function(data) {

				            if (data.sleep == 'Y') {
				    			post_goto('/sleepUser' , {'userId': data.userId});
				            } else if (data.changePw == 'Y') {
				                var contents = new Object();
				                contents.title = "알림";
				                contents.contents = data.message;
				                contents.cancelLabel = "다음에 변경";
				                contents.confirmLabel = "비밀번호 변경";

				                AP.modal.info(contents).addListener('modal-close', function(e) {
				                    if (e.closeType == 'close' || e.closeType == 'cancel') {
				                        location.href = returnUrl;
				                    } else if (e.closeType == 'confirm') {
				                        location.href = '/my/page/info/changeUserInfo';
				                    }
				                    console.log(e.closeType); //close, confirm, cancel
				                });
				            } else {
				            	loginComplete();
				            }

				        }).fail(function(xhr, textStatus, errorThrown) {
				            $("#complete3").removeAttr("disabled");
				            if (xhr.errorCode == 0) {
				                AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
				            } else {
				                AP.modal.alert(xhr.errorMessage)
				            }
						});
					}
					
					function loginProcess2() {
					    var $form = $('form#mobile');
					    $form.validate().settings.ignore = "";
					    if ($form.valid()) {

					        $("#complete2").attr("disabled", "disabled");
					        AP.api.mobileLogin({}, {
					            'incsNo': incsNo,
					            'smsNum': $('[name=smsNum]').val()

					        }, AP.common.getFormData($form)).done(function(data) {

				                AP.modal.alert("인증이 완료되었습니다.");
				                isLoginComplete = true;

					        }).fail(function(xhr, textStatus, errorThrown) {
					            $("#complete2").removeAttr("disabled");
					            if (xhr.errorCode == 0) {
					                AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
					            } else if (xhr.errorCode == 'ESAL062') {
					                AP.modal.alert("일일 인증실패 횟수를 초과했습니다.");
					            } else if (xhr.status == 401) {
					                AP.modal.alert("인증번호를 " + xhr.responseJSON.errorData.additional.dailyFailureCount + "회 잘못 입력하셨습니다.");
					            } else if (xhr.errorCode == 'EXTRA') {

					                if (xhr.responseJSON.errorData.additional.cs == 1) {

					                    $.get("/customer/popup?pageId=8", function(data) {

					                        var contents = new Object();
					                        contents.contents = data;
					                        var modal = AP.modal.info(contents);
					                        var $modalEl = modal.getElement(); //jquery object
					                        $modalEl.find('.term').click(function() {
					                            AP.modal.agreeTerms({
					                                title: '에뛰드 사이트 이용 약관',
					                                displayCode: 'ET001'
					                            });
					                        });


					                        $modalEl.find('[name=ET001]').on('click', function() {
					                        	if($(this).prop('checked')) {
					                        		$('.btn_lg_secondary').addClass('btn_lg_primary').removeClass('btn_lg_secondary');
					                        	} else {
					                        		$('.btn_lg_primary').addClass('btn_lg_secondary').removeClass('btn_lg_primary');
					                        	}
					                        });
					                        $modalEl.find('input').on('click', function() {
					                            if ($(this).attr('id') == 'choice0') {

					                                $modalEl.find("input[type=checkbox]").prop('checked', $(this).prop('checked'));

						                        	if($(this).prop('checked')) {
						                        		$('.btn_lg_secondary').addClass('btn_lg_primary').removeClass('btn_lg_secondary');
						                        	} else {
						                        		$('.btn_lg_primary').addClass('btn_lg_secondary').removeClass('btn_lg_primary');
						                        	}
						                        	
					                            } else {

					                                var isAll = true;

					                                $modalEl.find("input[type=checkbox]").each(function() {
					                                    if ($(this).attr('id') != 'choice0') {
					                                        if (!$(this).prop('checked')) {
					                                            isAll = false;
					                                        }
					                                    }
					                                });

					                                $('#choice0').prop('checked', isAll);
					                            }
					                        });

					                        $modalEl.find(".btn_lg_secondary").click(function() {

					                            if (!$modalEl.find('[name=ET001]').prop('checked')) {
					                                AP.modal.alert("필수 약관에 동의해주셔야 합니다.");
					                                return;
					                            }

					                            AP.api.simpleJoin({}, {
					                                terms: $modalEl.find('[name=ET001]').prop('checked'),
					                                sms: $modalEl.find('[name=SMS]').prop('checked'),
					                                email: $modalEl.find('[name=Email]').prop('checked')
					                            }).done(function(data) {
					                                location.href = "/customer/joinComplete";
					                            }).fail(function(xhr, textStatus, errorThrown) {
					                                AP.modal.alert("예상치 못한 오류가 발생하여 회원가입에 실패했습니다. 관리자에게 문의해 주세요.");
					                            }).always(function() {
					                                //성공, 실패
					                            });

					                        });
					                    });
					                } else if (xhr.responseJSON.errorData.additional.cs == 2) {

					                    $.get("/customer/popup?pageId=4&userId1=" + xhr.responseJSON.userId, function(data) {

					                        var contents = new Object();
					                        contents.contents = data;
					                        var modal = AP.modal.info(contents);
					                        var $modalEl = modal.getElement(); //jquery object

					                        $modalEl.find(".btn_md_primary").click(function() {
					                            modal.close();

					                        });
					                    });
					                } else if (xhr.responseJSON.errorData.additional.cs == 3) {

					                    $.get("/customer/popup?pageId=2", function(data) {

					                        var contents = new Object();
					                        contents.contents = data;
					                        var modal = AP.modal.info(contents);
					                        var $modalEl = modal.getElement(); //jquery object

					                        $modalEl.find(".btn_md_primary").click(function() {
					                            location.href = "/customer/signup?oldId=" + xhr.responseJSON.userId;

					                        });
					                    });
					                }

					            } else {
					                AP.modal.alert(xhr.errorMessage)
					            }
					        }).always(function() {
					            //성공, 실패
					        });
					    }
					}


					$('input[type=tel]').keydown(function(event) {
					    if (event.keyCode) {
					        var code = event.keyCode;
					        if ((code >= 48 && code <= 57) || (code >= 96 && code <= 105) || (code == 8) || (code == 9) || (code == 46)) {
					            return true;
					        } else {
					            return false;
					        }
					    } else if (e.which) {
					        var code = e.which;
					        if ((code >= 48 && code <= 57) || (code >= 96 && code <= 105) || (code == 8) || (code == 9) || (code == 46)) {
					            return true;
					        } else {
					            return false;
					        }
					    }
					});
					$('input[type=tel]').keyup(function(event) {
					    event = event || window.event;
					    var keyID = (event.which) ? event.which : event.keyCode;
					    if (keyID == 8 || keyID == 46 || keyID == 37 || keyID == 39)
					        return;
					    else
					        event.target.value = event.target.value.replace(/[^0-9]/g, "");
					});

					$('.btn_password').mousedown(function() {
					    $('[name=userPwdEc]').attr('type', 'text');

					});
					$('.btn_password').hover(function() {

					}, function() {
					    $('[name=userPwdEc]').attr('type', 'password');

					});
					$('.btn_password').mouseup(function() {
					    $('[name=userPwdEc]').attr('type', 'password');

					});

					$('.btn_del').click(function() {
					    $(this).parent().find('input').val(null);
					});
					if (AP.common.getCookie('is-user-id')) {
					    var $id = $('[name=chcsNo]');
					    if (AP.common.getCookie('user-id', null, 1) != 'on') {
					        $id.val(AP.common.getCookie('user-id', null, 1));
					        $id.parents().find('.placeholder').css('display', 'none');
					        $('#save_id').prop('checked', true);
					    }
					}
					$('#login').on('click', function() {
					    if ($(this).attr('disabled') == 'disabled') return;
					    loginProcess();
					    return false;
					});

					var returnUrl = '[[${returnUrl}]]';
					if (returnUrl == '') returnUrl = "/main";

					$('form [name=redirectUrl]').val(returnUrl);
					var t;

					function loginProcess() {
					    var $form = $('form#main');
					    if ($form.valid()) {
					        if (!$("[name=chcsNo]").val() || !$("[name=userPwdEc]").val()) {
					            return;
					        }

					        $("#login").attr("disabled", "disabled");
					        $("#login").addClass("disabled");
					        AP.api.doLogin({}, AP.common.getFormData($form)).done(function(data) {

					            if (data.sleep == 'Y') {
					    			post_goto('/sleepUser' , {'userId': data.userId});
					            } else if (data.changePw == 'Y') {
					                var contents = new Object();
					                contents.title = "알림";
					                contents.contents = data.message;
					                contents.cancelLabel = "다음에 변경";
					                contents.confirmLabel = "비밀번호 변경";

					                AP.modal.info(contents).addListener('modal-close', function(e) {
					                    if (e.closeType == 'close' || e.closeType == 'cancel') {
					                        location.href = returnUrl;
					                    } else if (e.closeType == 'confirm') {
					                        changePassword();
					                    }
					                    console.log(e.closeType); //close, confirm, cancel
					                });
					            } else {
					                if ($('#save_id').prop("checked")) {
					                    AP.common.setCookie('user-id', '', 0);
					                    AP.common.setCookie('is-user-id', '', 0);
					                    AP.common.setCookie('user-id', $('[name=chcsNo]').val(), 2592000000);
					                    AP.common.setCookie('is-user-id', $('#save_id').val(), 2592000000);
					                } else {
					                    AP.common.setCookie('user-id', '', 0);
					                    AP.common.setCookie('is-user-id', '', 0);
					                }
					                loginComplete();

					            }

					        }).fail(function(xhr, textStatus, errorThrown) {
					            $("#login").removeAttr("disabled");
					            $("#login").removeClass("disabled");
					            if (xhr.errorCode == 0) {
					                AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
					            } else if (xhr.errorCode == 'ESAL002') {
					                AP.modal.alert("아이디 또는 비밀번호가 일치하지 않습니다. 다시 입력해주세요.");
					            } else if (xhr.errorCode == 'ESAL003') {
					                if (xhr.responseJSON.isLock == true) {

					                    var contents = new Object();
					                    contents.title = "알림";
					                    contents.contents = "비밀번호를 5회 잘못 입력하셨습니다.\n\n개인정보보호를 위해\n30분간 로그인이 불가능합니다.";
					                    contents.cancelLabel = "확인";
					                    AP.modal.info(contents);

					                } else {
					                    $.get("/customer/popup?pageId=5", function(data) {

					                        var contents = new Object();
					                        contents.contents = data;
					                        var modal = AP.modal.info(contents);
					                        var $modalEl = modal.getElement(); //jquery object
					                        if(t2 == null) {
					                        	t2 = new AP.common.timeCountDown(xhr.responseJSON.errorData.additional.lockReleaseDate, function() {}, "#lock-time");
					                        	t2.start();
					                        } else {
					                        	t2.stop();
					                            t2 = new AP.common.timeCountDown(xhr.responseJSON.errorData.additional.lockReleaseDate, function() {}, "#lock-time");
					                            t2.start();
					                        }
					                        $modalEl.find(".btn_md_primary").click(function() {
					                            t.stop;
					                            modal.close();
					                        });
					                    });
					                }

					            } else if (xhr.errorCode == 'EXTRA') {

					                if (xhr.responseJSON.errorData.additional.cs == 1) {

					                    $.get("/customer/popup?pageId=8", function(data) {

					                        var contents = new Object();
					                        contents.contents = data;
					                        var modal = AP.modal.info(contents);
					                        var $modalEl = modal.getElement(); //jquery object
					                        $modalEl.find('.term').click(function() {
					                            AP.modal.agreeTerms({
					                                title: '에뛰드 사이트 이용 약관',
					                                displayCode: 'ET001'
					                            });
					                        });


					                        $modalEl.find('[name=ET001]').on('click', function() {
					                        	if($(this).prop('checked')) {
					                        		$('.btn_lg_secondary').addClass('btn_lg_primary').removeClass('btn_lg_secondary');
					                        	} else {
					                        		$('.btn_lg_primary').addClass('btn_lg_secondary').removeClass('btn_lg_primary');
					                        	}
					                        });
					                        $modalEl.find('input').on('click', function() {
					                            if ($(this).attr('id') == 'choice0') {

					                                $modalEl.find("input[type=checkbox]").prop('checked', $(this).prop('checked'));

						                        	if($(this).prop('checked')) {
						                        		$('.btn_lg_secondary').addClass('btn_lg_primary').removeClass('btn_lg_secondary');
						                        	} else {
						                        		$('.btn_lg_primary').addClass('btn_lg_secondary').removeClass('btn_lg_primary');
						                        	}
						                        	
					                            } else {

					                                var isAll = true;

					                                $modalEl.find("input[type=checkbox]").each(function() {
					                                    if ($(this).attr('id') != 'choice0') {
					                                        if (!$(this).prop('checked')) {
					                                            isAll = false;
					                                        }
					                                    }
					                                });

					                                $('#choice0').prop('checked', isAll);
					                            }
					                        });

					                        $modalEl.find(".btn_lg_secondary").click(function() {

					                            if (!$modalEl.find('[name=ET001]').prop('checked')) {
					                                AP.modal.alert("필수 약관에 동의해주셔야 합니다.");
					                                return;
					                            }

					                            AP.api.simpleJoin({}, {
					                                terms: $modalEl.find('[name=ET001]').prop('checked'),
					                                sms: $modalEl.find('[name=SMS]').prop('checked'),
					                                email: $modalEl.find('[name=Email]').prop('checked')
					                            }).done(function(data) {
					                                location.href = "/customer/joinComplete";
					                            }).fail(function(xhr, textStatus, errorThrown) {
					                                AP.modal.alert("예상치 못한 오류가 발생하여 회원가입에 실패했습니다. 관리자에게 문의해 주세요.");
					                            }).always(function() {
					                                //성공, 실패
					                            });

					                        });
					                    });
					                } else if (xhr.responseJSON.errorData.additional.cs == 2) {

					                    $.get("/customer/popup?pageId=4&userId1=" + xhr.responseJSON.userId, function(data) {

					                        var contents = new Object();
					                        contents.contents = data;
					                        var modal = AP.modal.info(contents);
					                        var $modalEl = modal.getElement(); //jquery object

					                        $modalEl.find(".btn_md_primary").click(function() {
					                            modal.close();

					                        });
					                    });
					                } else if (xhr.responseJSON.errorData.additional.cs == 3) {

					                    $.get("/customer/popup?pageId=2", function(data) {

					                        var contents = new Object();
					                        contents.contents = data;
					                        var modal = AP.modal.info(contents);
					                        var $modalEl = modal.getElement(); //jquery object

					                        $modalEl.find(".btn_md_primary").click(function() {
					                            location.href = "/customer/signup?oldId=" + xhr.responseJSON.userId;

					                        });
					                    });
					                }

					            } else {
					                AP.modal.alert(xhr.errorMessage)
					            }
					        }).always(function() {
					            //성공, 실패
					        });
					    }
					}

					//전환가입 안내
					function changeInfoModal() {
					    var contents = new Object();
					    contents.title = "고객님! 아모레퍼시픽<br>통합 멤버십으로 전환하세요!";
					    contents.contents = "<p class=\"text_center\">아모레퍼시픽 통합멤버십 회원이 되시면,</p>\n" +
					        "                            <br>\n" +
					        "                            <ul class=\"list_bullet\">\n" +
					        "                            \t<li><span>1)</span> 에뛰드하우스 및 자회사 등 아모레퍼시픽계열<br>모든 쇼핑몰 한 아이디로 간편하게 이용할 수 있습니다.</li>\n" +
					        "                            \t<li><span>2)</span> 하나의 아이디로 편리하게, 통합멤버십(뷰티포인트) 적립 및 다양한 서비스와 혜택을 누리실 수 있습니다.</li>\n" +
					        "                            </ul>";
					    contents.cancelLabel = "취소";
					    contents.confirmLabel = "전환가입";

					    AP.modal.info(contents).addListener('modal-close', function(e) {
					        if (e.closeType == 'close' || e.closeType == 'cancel') {} else if (e.closeType == 'confirm') {
					            location.href = "/conversionSignup";
					        }
					    });
					}

					function changePassword() {


					    $.get("/my/page/info/changePwdForm", function(data) {
					        /**
					         * 동적으로 생성된 modal의 Node Element 접근하기
					         * alert, confirm, info 모두 동일
					         */

					        var contents = new Object();
					        contents.contents = data;
					        var modal = AP.modal.info(contents);
					        var $modalEl = modal.getElement(); //jquery object

					        $(".layer_close").click(function() {
					            location.href = returnUrl;
					        });
					        $("#cancel-change-pwd").click(function() {
					            location.href = returnUrl;
					        });

					        $("#submit-change-pwd").click(function() {
					            if ($("#pw-change-form").valid()) {
					                if ($("#pass1").val() != $("#pass2").val()) {
					                    AP.modal.alert("새 비밀번호가 일치하지 않습니다.");
					                    return false;
					                }

					                AP.api.changePwd2({}, AP.common.getFormData($('#pw-change-form'))).done(function(data) {
					                    AP.modal.alert("비밀번호가 변경되었습니다.").addListener('modal-close', function(e) {
					                        location.href = returnUrl;
					                    });
					                }).fail(function(xhr, textStatus, errorThrown) {
					                    if (xhr.errorCode == 0) {
					                        AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
					                    } else if (xhr.errorCode == 'EAPI005') {
					                        AP.modal.alert("아이디 또는 비밀번호가 일치하지 않습니다. 다시 입력해주세요.");
					                    } else {
					                        AP.modal.alert(xhr.errorMessage)
					                    }
					                }).always(function() {
					                    //성공, 실패
					                });
					            }
					        });

					    });
					}

					//카카오으로 로그인
					function snsKakao() {
					    Kakao.Auth.login({
					        persistRefreshToken: true,
					        success: function(authObj) {
					            Kakao.Auth.setAccessToken(authObj.access_token);

					            Kakao.API.request({
					                url: '/v1/user/me',
					                success: function(res) {

					                    var indexed_array = {};
					                    indexed_array['snsName'] = 'Kakao';
					                    indexed_array['id'] = res.id;
					                    $.ajax({
					                        type: "POST",
					                        url: "/login/snsloginProcess",
					                        data: indexed_array,
					                        success: function(data) {
					                            if (data.state == 'success') {
					                                if (data.isLinked) {
					                                    window.location.href = returnUrl;
					                                } else {
					                                    location.href = "/login/snsLinkPage";
					                                    window.close();
					                                }
					                            }
					                            //성공
					                        },
					                        dataType: "json"
					                    });
					                },
					                fail: function(error) {
					                    alert(JSON.stringify(error));
					                }
					            });


					        },
					        fail: function(err) {
					            console.log(JSON.stringify(err));
					            alert(JSON.stringify(err));
					        }
					    });
					}

					//페이스북으로 로그인
					window.fbAsyncInit = function() {
					    FB.init({
					        appId: '[[${@environment.getProperty('facebook.key')}]]',
					        cookie: true,
					        xfbml: true,
					        version: 'v2.11'
					    });

					    FB.AppEvents.logPageView();

					};

					(function(d, s, id) {
					    var js, fjs = d.getElementsByTagName(s)[0];
					    if (d.getElementById(id)) {
					        return;
					    }
					    js = d.createElement(s);
					    js.id = id;
					    js.src = "https://connect.facebook.net/en_US/sdk.js";
					    fjs.parentNode.insertBefore(js, fjs);

					}(document, 'script', 'facebook-jssdk'));

					function facebookLogin() {

					    FB.login(function(response) {
					        //statusChangeCallback(response);   -- FB 로그인 취소시, 무한루프에 빠지게됨
					        if (response.status === 'connected') {
					            // 페이스북과 앱에 같이 로그인되어 있다.
					            $("#accessToken").val(response.authResponse.accessToken);
					            fncFBCallback(response.authResponse.accessToken);
					        } else if (response.status === 'not_authorized') {
					            // 페이스북에는 로그인 되어있으나, 앱에는 로그인 되어있지 않다.
					            AP.modal.alert('Facebook 계정 설정에서 해당 어플리케이션이 인가되지 않았습니다.\n다시 로그인 버튼을 클릭후, 어플리케이션 사용을 승인하여 주십시오.');
					        } else {
					            // 페이스북에 로그인이 되어있지 않아서, 앱에 로그인 되어있는지 불명확하다.
					            AP.modal.alert('Facebook 에 로그인되지 않았습니다.');
					        }
					    });
					}

					function naverLogin() {
					    window.open('https://nid.naver.com/oauth2.0/authorize?response_type=token&client_id=[[${@environment.getProperty('naver.key')}]]&state=[[${state}]]&redirect_uri=' + location.href.replace('login', 'navercallback').split('#')[0], 'naverloginpop', 'titlebar=1, resizable=1, scrollbars=yes, width=750, height=550');
					    return false;
					}

					function kakaoLogin() {
						var returl = location.href.replace('login', '').split('#')[0] + 'kakaocallback';
						AP.api.saveUrl({}, {
							url:returl
						}).done(function(data) {
						    window.open('https://kauth.kakao.com/oauth/authorize?client_id=[[${@environment.getProperty('kakao.restkey')}]]&response_type=code&redirect_uri=' + returl, 'kakaologinpop', 'titlebar=1, resizable=1, scrollbars=yes, width=600, height=550');
				        }).fail(function(xhr, textStatus, errorThrown) {
							AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
				        }).always(function() {
				            $("#send-sms").removeAttr("disabled");
				            //성공, 실패
				        });
						
					    return false
					}

					function fncFBCallback(token) {
					    FB.api('/me', {
					        fields: 'email, birthday, name'
					    }, function(response) {

					        var indexed_array = {};
					        indexed_array['snsName'] = 'Facebook';
					        indexed_array['id'] = response.id;
					        indexed_array['accessToken'] = token;

					        $.ajax({
					            type: "POST",
					            url: "/login/snsloginProcess",
					            data: indexed_array,
					            success: function(data) {
					                if (data.isLinked) {
					                    nbSuccess(data);
					                } else {
					                    doSnsLogin();
					                }
					                //성공
					            },
					            dataType: "json"
					        });
					    });
					}

					function nbSuccess(data) {

					    if (data.sleep == 'Y') {
							post_goto('/sleepUser' , {'userId': data.userId});

					    } else if (data.old == 'Y') {

					    } else if (data.changePw == 'Y') {
					        var contents = new Object();
					        contents.title = "알림";
					        contents.contents = "고객님!<br>" +
					            "비밀번호를 3개월동안 변경하지 않으셨습니다.<br><br>" +
					            "개인정보보호를 위해<br>비밀번호를 변경해주세요.";
					        contents.cancelLabel = "다음에 변경";
					        contents.confirmLabel = "비밀번호 변경";

					        AP.modal.info(contents).addListener('modal-close', function(e) {
					            if (e.closeType == 'close' || e.closeType == 'cancel') {
					                location.href = returnUrl;
					            } else if (e.closeType == 'confirm') {
					                changePassword();
					            }
					            console.log(e.closeType); //close, confirm, cancel
					        });
					    } else {
					        loginComplete();
					    }
					}

					function doSnsLogin() {

					    $.get("/snsLinkLoginForm", function(data) {

					        var contents = new Object();
					        contents.contents = data;
					        var modal = AP.modal.info(contents);
					        var $modalEl = modal.getElement(); //jquery object

					        $(".layer_close").click(function() {
					            modal.close();
					        });

					        $('#sns-login').click(function() {
					            var $form = $modalEl.find('#form');
					            if ($form.valid()) {

					                AP.api.doLoginLink({}, AP.common.getFormData($form)).done(function(data) {
					                    //성공
					                    var returnUrl = "/main"
					                    if (data.returnUrl)
					                        returnUrl = data.returnUrl;

					                    if (data.sleep == 'Y') {
					            			post_goto('/sleepUser' , {'userId': data.userId});

					                    } else if (data.old == 'Y') {
					                        var contents = new Object();
					                        contents.title = "[[#{customer.login.changeIntegratedTitle}]]";
					                        contents.contents = "[[#{customer.login.changeIntegratedContent}]]";
					                        contents.cancelLabel = "[[#{common.cancel}]]";
					                        contents.confirmLabel = "[[#{customer.login.changeIntegrated}]]";

					                        AP.modal.info(contents).addListener('modal-close', function(e) {
					                            if (e.closeType == 'close' || e.closeType == 'cancel') {} else if (e.closeType == 'confirm') {
					                                location.href = "/customer/signup";
					                            }
					                            console.log(e.closeType); //close, confirm, cancel
					                        });
					                    } else if (data.changePw == 'Y') {
					                        var contents = new Object();
					                        contents.title = "[[#{common.alert}]]";
					                        contents.contents = "고객님!<br>" +
					                            "비밀번호를 3개월동안 변경하지 않으셨습니다.<br><br>" +
					                            "개인정보보호를 위해<br>비밀번호를 변경해주세요.";
					                        contents.cancelLabel = "다음에 변경";
					                        contents.confirmLabel = "비밀번호 변경";

					                        AP.modal.info(contents).addListener('modal-close', function(e) {
					                            if (e.closeType == 'close' || e.closeType == 'cancel') {
					                                location.href = returnUrl;
					                            } else if (e.closeType == 'confirm') {
					                                location.href = "/customer/signup";
					                            }
					                            console.log(e.closeType); //close, confirm, cancel
					                        });
					                    } else {
					                        loginComplete();
					                    }

					                }).fail(function(xhr, textStatus, errorThrown) {
					                    $("#login").removeAttr("disabled");
					                    if (xhr.errorCode == 0) {
					                        AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
					                    } else if (xhr.errorCode == 'EAPI005') {
					                        AP.modal.alert("아이디 또는 비밀번호가 일치하지 않습니다. 다시 입력해주세요.");
					                    } else {
					                        AP.modal.alert(xhr.errorMessage)
					                    }
					                }).always(function() {
					                    //성공, 실패
					                });

					            }
					        });

					    });
					}

					function loginComplete() {
				        if ($('#sub').attr('method') == 'POSTs')
				            $('#sub').submit();
				        else
				            location.href = $('#sub').attr('action').replace('?isRequiredLogin=true', '').replace('/order/reception','/cart/cartList');

					}

					function nomember() {
						if(!$('[name=custNm2]').val()) {
	                        AP.modal.alert("이름을 입력해 주세요. 이름 입력창으로 이동합니다.").addListener('modal-close', function(e) {
	                        	$('[name=custNm2]').focus();
						    });
	                        return;
						}
						if(!$('[name=ordNo]').val()) {
	                        AP.modal.alert("주문번호를 입력해 주세요. 주문번호 입력창으로 이동합니다.").addListener('modal-close', function(e) {
	                        	$('[name=ordNo]').focus();
						    });
	                        return;
						}
						
					    AP.api.checkOrder({}, {
					    	ordNo: $('[name=ordNo]').val(),
					    	custNm: $('[name=custNm2]').val()
					    }).done(function(data) {
							post_goto('/non/order/detail/' + $('[name=ordNo]').val() , {'custNm': $('[name=custNm2]').val()});
					    }).fail(function(xhr, textStatus, errorThrown) {
					        AP.modal.alert(xhr.errorMessage)
					    }).always(function() {
					        //성공, 실패
					    });
					}
			</script>
			            
        </th:block>
</body>
</html>